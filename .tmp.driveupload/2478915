"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[260],{2260:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var n=s(2555),r=s(5043),a=s(6446),i=s(794),o=s(7254),l=s(7392),c=s(5865),d=s(1906),u=s(1637),m=s(8903),h=s(2110),p=s(6494),g=s(7784),x=s(5260),y=s(4605),A=s(6374),v=s(1962),j=s(3193),f=s(9190),_=s(2221),b=s(2143),w=s(3336),C=s(7332),S=s(7141),I=s(8262),P=s(141),k=s(1082),T=s(5275),E=s(3260),q=s(6291),R=s(5563),W=s(579);const z={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"http://localhost:8000/api"}.REACT_APP_GOOGLE_MAPS_API_KEY||"",O=e=>{let{center:t,zoom:s,children:n,onAddressSelect:a}=e;const i=r.useRef(null),[o,l]=r.useState();return r.useEffect((()=>{if(i.current&&!o){const e=new window.google.maps.Map(i.current,{center:t,zoom:s,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]});if(a){const t=new google.maps.Geocoder;e.addListener("click",(e=>{e.latLng&&t.geocode({location:e.latLng},((t,s)=>{if("OK"===s&&t&&t[0]){const s=t[0].formatted_address,n={lat:e.latLng.lat(),lng:e.latLng.lng()};a(s,n)}}))}))}l(e)}}),[i,o,t,s,a]),(0,W.jsx)("div",{ref:i,style:{width:"100%",height:"300px"},children:r.Children.map(n,(e=>{if(r.isValidElement(e))return r.cloneElement(e,{map:o})}))})},L=e=>{let{position:t,map:s}=e;const[n,a]=r.useState();return r.useEffect((()=>(!n&&s&&a(new google.maps.Marker({position:t,map:s})),()=>{n&&n.setMap(null)})),[n,t,s]),r.useEffect((()=>{n&&n.setPosition(t)}),[n,t]),null},M=e=>{switch(e){case R.Status.LOADING:return(0,W.jsx)("div",{style:{height:"300px",display:"flex",alignItems:"center",justifyContent:"center"},children:"Loading map..."});case R.Status.FAILURE:return(0,W.jsx)("div",{style:{height:"300px",display:"flex",alignItems:"center",justifyContent:"center"},children:"Error loading map"});case R.Status.SUCCESS:return(0,W.jsx)("div",{children:"Map loaded successfully"})}},F=e=>{let{children:t}=e;return z?(0,W.jsx)(R.Wrapper,{apiKey:z,render:M,children:t}):(0,W.jsx)("div",{style:{height:"300px",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:"Google Maps API key not configured"})},N=()=>{const e=(0,E.Zp)(),[t,s]=(0,r.useState)(!1),[R,z]=(0,r.useState)(null),[M,N]=(0,r.useState)(null),[U,B]=(0,r.useState)({lat:40.7128,lng:-74.006}),[D,H]=(0,r.useState)({lat:40.7128,lng:-74.006}),[G,K]=(0,r.useState)({first_name:"",last_name:"",display_name:"",email:"",mobile_phone:"",home_phone:"",work_phone:"",company:"",role:"homeowner",street:"",unit:"",city:"",state:"",zip:"",address_notes:"",notes:"",send_notifications:!0,do_not_service:!1}),[Y,X]=(0,r.useState)({}),Z=(e,t)=>{if(K((s=>(0,n.A)((0,n.A)({},s),{},{[e]:t}))),Y[e]&&X((t=>{const s=(0,n.A)({},t);return delete s[e],s})),"first_name"===e||"last_name"===e){const s="first_name"===e?t:G.first_name,r="last_name"===e?t:G.last_name;K((e=>(0,n.A)((0,n.A)({},e),{},{display_name:"".concat(s," ").concat(r).trim()})))}},J=async()=>{const e="".concat(G.street," ").concat(G.unit,", ").concat(G.city,", ").concat(G.state," ").concat(G.zip).trim();if(e.length>5){const t=await(async e=>{if(!window.google)return null;const t=new google.maps.Geocoder;return new Promise((s=>{t.geocode({address:e},((e,t)=>{if("OK"===t&&e&&e[0]){const t=e[0].geometry.location;s({lat:t.lat(),lng:t.lng()})}else s(null)}))}))})(e);t&&(B(t),H(t))}},V=()=>{e("/customers")};return r.useEffect((()=>{const e=setTimeout((()=>{G.street&&G.city&&G.state&&J()}),1e3);return()=>clearTimeout(e)}),[G.street,G.city,G.state,G.zip]),(0,W.jsxs)(a.A,{sx:{maxWidth:1200,mx:"auto",p:3},children:[(0,W.jsx)(i.A,{open:!!R,autoHideDuration:6e3,onClose:()=>z(null),children:(0,W.jsx)(o.A,{severity:"error",onClose:()=>z(null),children:R})}),(0,W.jsx)(i.A,{open:!!M,autoHideDuration:6e3,onClose:()=>N(null),children:(0,W.jsx)(o.A,{severity:"success",onClose:()=>N(null),children:M})}),(0,W.jsxs)(a.A,{display:"flex",alignItems:"center",mb:3,children:[(0,W.jsx)(l.A,{onClick:V,sx:{mr:2},children:(0,W.jsx)(C.A,{})}),(0,W.jsx)(c.A,{variant:"h4",component:"h1",sx:{flexGrow:1},children:"Add new customer"}),(0,W.jsx)(d.A,{variant:"outlined",onClick:V,sx:{mr:2},children:"Cancel"}),(0,W.jsx)(d.A,{variant:"contained",startIcon:t?(0,W.jsx)(u.A,{size:20}):(0,W.jsx)(S.A,{}),onClick:async()=>{if((()=>{const e={};return G.first_name.trim()||(e.first_name="First name is required"),G.last_name.trim()||(e.last_name="Last name is required"),G.email.trim()||(e.email="Email is required"),G.mobile_phone.trim()||G.home_phone.trim()||G.work_phone.trim()||(e.mobile_phone="At least one phone number is required"),G.street.trim()||(e.street="Street address is required"),G.city.trim()||(e.city="City is required"),G.state.trim()||(e.state="State is required"),G.zip.trim()||(e.zip="ZIP code is required"),G.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(G.email)&&(e.email="Please enter a valid email address"),X(e),0===Object.keys(e).length})())try{s(!0),z(null);const t={first_name:G.first_name,last_name:G.last_name,email:G.email,phone:G.mobile_phone||G.home_phone||G.work_phone,customer_type:"business"===G.role?"commercial":"residential",street_address:"".concat(G.street).concat(G.unit?" ".concat(G.unit):""),city:G.city,state:G.state,zip_code:G.zip,company_name:"business"===G.role?G.company:"",preferred_contact_method:"email",notes:G.notes},n=await q.dr.create(t);N("Customer created successfully!"),setTimeout((()=>{e("/customers/".concat(n.data.id))}),1500)}catch(r){var t,n;console.error("Error creating customer:",r),z((null===(t=r.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to create customer")}finally{s(!1)}},disabled:t,children:t?"Saving...":"Save"})]}),(0,W.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,W.jsxs)(m.Ay,{item:!0,xs:12,md:8,children:[(0,W.jsx)(h.A,{sx:{mb:3},children:(0,W.jsxs)(p.A,{children:[(0,W.jsxs)(a.A,{display:"flex",alignItems:"center",mb:3,children:[(0,W.jsx)(a.A,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:(0,W.jsx)(I.A,{sx:{color:"white"}})}),(0,W.jsx)(c.A,{variant:"h6",children:"Contact info"})]}),(0,W.jsxs)(m.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"First name",value:G.first_name,onChange:e=>Z("first_name",e.target.value),error:!!Y.first_name,helperText:Y.first_name,required:!0})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Last name",value:G.last_name,onChange:e=>Z("last_name",e.target.value),error:!!Y.last_name,helperText:Y.last_name,required:!0})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Mobile phone",value:G.mobile_phone,onChange:e=>Z("mobile_phone",e.target.value),error:!!Y.mobile_phone,helperText:Y.mobile_phone})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Company",value:G.company,onChange:e=>Z("company",e.target.value)})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Display name (shown on invoices)",value:G.display_name,onChange:e=>Z("display_name",e.target.value)})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Home phone",value:G.home_phone,onChange:e=>Z("home_phone",e.target.value)})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsxs)(a.A,{children:[(0,W.jsx)(c.A,{variant:"body2",sx:{mb:1},children:"Role"}),(0,W.jsxs)(x.A,{row:!0,value:G.role,onChange:e=>Z("role",e.target.value),children:[(0,W.jsx)(y.A,{value:"homeowner",control:(0,W.jsx)(A.A,{}),label:"Homeowner"}),(0,W.jsx)(y.A,{value:"business",control:(0,W.jsx)(A.A,{}),label:"Business"})]})]})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Email",type:"email",value:G.email,onChange:e=>Z("email",e.target.value),error:!!Y.email,helperText:Y.email,required:!0})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Work phone",value:G.work_phone,onChange:e=>Z("work_phone",e.target.value)})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(a.A,{sx:{pt:2},children:(0,W.jsx)(y.A,{control:(0,W.jsx)(v.A,{checked:G.do_not_service,onChange:e=>Z("do_not_service",e.target.checked)}),label:(0,W.jsxs)(a.A,{children:[(0,W.jsx)(c.A,{variant:"body2",children:'Mark as "Do not service"'}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Notifications will be turned off and it won't be possible to schedule a job or estimate."})]})})})})]}),(0,W.jsxs)(a.A,{sx:{mt:2},children:[(0,W.jsx)(d.A,{startIcon:(0,W.jsx)(P.A,{}),size:"small",children:"Email"}),(0,W.jsx)(d.A,{startIcon:(0,W.jsx)(P.A,{}),size:"small",sx:{ml:2},children:"Phone"})]})]})}),(0,W.jsx)(h.A,{sx:{mb:3},children:(0,W.jsxs)(p.A,{children:[(0,W.jsxs)(a.A,{display:"flex",alignItems:"center",mb:3,children:[(0,W.jsx)(a.A,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:(0,W.jsx)(k.A,{sx:{color:"white"}})}),(0,W.jsx)(c.A,{variant:"h6",children:"Address"})]}),(0,W.jsxs)(m.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(m.Ay,{item:!0,xs:12,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Street",value:G.street,onChange:e=>Z("street",e.target.value),error:!!Y.street,helperText:Y.street,required:!0})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Unit",value:G.unit,onChange:e=>Z("unit",e.target.value)})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"City",value:G.city,onChange:e=>Z("city",e.target.value),error:!!Y.city,helperText:Y.city,required:!0})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:2,children:(0,W.jsxs)(j.A,{fullWidth:!0,error:!!Y.state,children:[(0,W.jsx)(f.A,{children:"State"}),(0,W.jsxs)(_.A,{value:G.state,label:"State",onChange:e=>Z("state",e.target.value),children:[(0,W.jsx)(b.A,{value:"NY",children:"NY"}),(0,W.jsx)(b.A,{value:"NJ",children:"NJ"}),(0,W.jsx)(b.A,{value:"CT",children:"CT"}),(0,W.jsx)(b.A,{value:"PA",children:"PA"})]})]})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,sm:2,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Zip",value:G.zip,onChange:e=>Z("zip",e.target.value),error:!!Y.zip,helperText:Y.zip,required:!0})}),(0,W.jsx)(m.Ay,{item:!0,xs:12,children:(0,W.jsx)(g.A,{fullWidth:!0,label:"Address Notes",multiline:!0,rows:2,value:G.address_notes,onChange:e=>Z("address_notes",e.target.value)})})]}),(0,W.jsx)(a.A,{sx:{mt:2},children:(0,W.jsx)(d.A,{startIcon:(0,W.jsx)(P.A,{}),size:"small",children:"Address"})})]})}),(0,W.jsx)(h.A,{children:(0,W.jsxs)(p.A,{children:[(0,W.jsxs)(a.A,{display:"flex",alignItems:"center",mb:3,children:[(0,W.jsx)(a.A,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:(0,W.jsx)(T.A,{sx:{color:"white"}})}),(0,W.jsx)(c.A,{variant:"h6",children:"Notes"})]}),(0,W.jsx)(g.A,{fullWidth:!0,multiline:!0,rows:4,value:G.notes,onChange:e=>Z("notes",e.target.value),placeholder:"Add notes about this customer..."}),(0,W.jsx)(a.A,{sx:{mt:2},children:(0,W.jsx)(y.A,{control:(0,W.jsx)(v.A,{checked:G.send_notifications,onChange:e=>Z("send_notifications",e.target.checked)}),label:"Send notifications"})})]})})]}),(0,W.jsx)(m.Ay,{item:!0,xs:12,md:4,children:(0,W.jsx)(a.A,{sx:{position:"sticky",top:20},children:(0,W.jsx)(w.A,{sx:{p:2,height:400},children:(0,W.jsx)(F,{children:(0,W.jsx)(O,{center:U,zoom:15,onAddressSelect:(e,t)=>{const s=e.split(", ");if(s.length>=3){const e=s[0],t=s[s.length-3],r=s[s.length-2].match(/^(.+?)\s+(\d{5}(-\d{4})?)$/);K((s=>(0,n.A)((0,n.A)({},s),{},{street:e,city:t,state:r?r[1]:"",zip:r?r[2]:""})))}H(t)},children:(0,W.jsx)(L,{position:D})})})})})})]})]})}},6291:(e,t,s)=>{s.d(t,{Ay:()=>h,LP:()=>m,S:()=>c,Up:()=>l,dr:()=>o,l:()=>d,pO:()=>u});var n=s(9722),r=s(4703);const a=n.A.create({baseURL:"http://localhost:8000/api",headers:{"Content-Type":"application/json"},timeout:1e4});a.interceptors.request.use((e=>{var t;e.metadata={startTime:performance.now()};const s=localStorage.getItem("authToken");s&&(e.headers.Authorization="Bearer ".concat(s)),e.headers["X-Requested-With"]="XMLHttpRequest";const n=null===(t=document.querySelector('meta[name="csrf-token"]'))||void 0===t?void 0:t.getAttribute("content");return n&&(e.headers["X-CSRF-Token"]=n),e}),(e=>(r.Fk.handleError(e,{component:"APIService",action:"Request Interceptor",userMessage:"Failed to prepare API request"}),Promise.reject(e)))),a.interceptors.response.use((e=>{var t;const s=e.config,n=performance.now()-((null===(t=s.metadata)||void 0===t?void 0:t.startTime)||0);var a,i;n>2e3&&(console.warn("\u26a0\ufe0f Slow API call: ".concat(null===(a=e.config.method)||void 0===a?void 0:a.toUpperCase()," ").concat(e.config.url," took ").concat(Math.round(n),"ms")),r.Fk.handleError(new Error("Slow API response"),{component:"APIService",action:"Slow Response: ".concat(null===(i=e.config.method)||void 0===i?void 0:i.toUpperCase()," ").concat(e.config.url),userMessage:"API response was slower than expected"}));return e}),(async e=>{var t,n,o,l,c;r.Fk.handleError(e,{component:"APIService",action:"".concat(null===(t=e.config)||void 0===t||null===(n=t.method)||void 0===n?void 0:n.toUpperCase()," ").concat(null===(o=e.config)||void 0===o?void 0:o.url),userMessage:i(e)});if(401===(null===(l=e.response)||void 0===l?void 0:l.status)){const{authService:t}=await s.e(422).then(s.bind(s,1422)),n=await t.refreshToken();if(n&&e.config)return e.config.headers.Authorization="Bearer ".concat(n),a.request(e.config);t.logout()}if(429===(null===(c=e.response)||void 0===c?void 0:c.status)){const t=e.response.headers["retry-after"],s=t?1e3*parseInt(t):1e3;return console.warn("Rate limited. Retrying after ".concat(s,"ms")),new Promise(((t,n)=>{setTimeout((()=>{e.config?a.request(e.config).then(t).catch(n):n(e)}),s)}))}return Promise.reject(e)}));const i=e=>{if(!e.response)return"Network connection error. Please check your internet connection.";const t=e.response.status,s=e.response.data;switch(t){case 400:return(null===s||void 0===s?void 0:s.message)||"Invalid request. Please check your input.";case 401:return"Your session has expired. Please log in again.";case 403:return"You do not have permission to perform this action.";case 404:return"The requested resource was not found.";case 422:return(null===s||void 0===s?void 0:s.message)||"Please check your input and try again.";case 429:return"Too many requests. Please wait a moment and try again.";case 500:return"Server error occurred. Our team has been notified.";case 502:case 503:case 504:return"Service temporarily unavailable. Please try again later.";default:return(null===s||void 0===s?void 0:s.message)||"An unexpected error occurred. Please try again."}},o={getAll:e=>a.get("/customers/",{params:e}),getById:e=>a.get("/customers/".concat(e,"/")),create:e=>a.post("/customers/",e),update:(e,t)=>a.put("/customers/".concat(e,"/"),t),delete:e=>a.delete("/customers/".concat(e,"/")),getProperties:e=>a.get("/customers/".concat(e,"/properties/")),addProperty:(e,t)=>a.post("/customers/".concat(e,"/add_property/"),t),getContacts:e=>a.get("/customers/".concat(e,"/contacts/")),addContact:(e,t)=>a.post("/customers/".concat(e,"/add_contact/"),t),getReviews:e=>a.get("/customers/".concat(e,"/reviews/")),addReview:(e,t)=>a.post("/customers/".concat(e,"/add_review/"),t)},l={getAll:e=>a.get("/properties/",{params:e}),getById:e=>a.get("/properties/".concat(e,"/")),create:e=>a.post("/properties/",e),update:(e,t)=>a.put("/properties/".concat(e,"/"),t),delete:e=>a.delete("/properties/".concat(e,"/"))},c={getAll:e=>a.get("/jobs/",{params:e}),getById:e=>a.get("/jobs/".concat(e,"/")),create:e=>a.post("/jobs/",e),update:(e,t)=>a.put("/jobs/".concat(e,"/"),t),delete:e=>a.delete("/jobs/".concat(e,"/")),updateStatus:(e,t)=>a.patch("/jobs/".concat(e,"/update_status/"),{status:t}),assignTechnicians:(e,t)=>a.patch("/jobs/".concat(e,"/assign_technicians/"),{technician_ids:t})},d={getAll:e=>a.get("/jobs/technicians/",{params:e}),getAvailable:e=>a.get("/jobs/technicians/available/",{params:e}),getById:e=>a.get("/jobs/technicians/".concat(e,"/"))},u={getItems:e=>a.get("/inventory/items/",{params:e}),getItemById:e=>a.get("/inventory/items/".concat(e,"/")),createItem:e=>a.post("/inventory/items/",e),updateItem:(e,t)=>a.put("/inventory/items/".concat(e,"/"),t),deleteItem:e=>a.delete("/inventory/items/".concat(e,"/")),adjustStock:(e,t,s)=>a.post("/inventory/items/".concat(e,"/adjust_stock/"),{quantity:t,reason:s}),getCategories:()=>a.get("/inventory/categories/"),createCategory:e=>a.post("/inventory/categories/",e),getSuppliers:()=>a.get("/inventory/suppliers/"),createSupplier:e=>a.post("/inventory/suppliers/",e),getStockMovements:e=>a.get("/inventory/stock-movements/",{params:e}),getPurchaseOrders:e=>a.get("/inventory/purchase-orders/",{params:e}),createPurchaseOrder:e=>a.post("/inventory/purchase-orders/",e),updatePurchaseOrder:(e,t)=>a.put("/inventory/purchase-orders/".concat(e,"/"),t)},m={getBusinessOverview:()=>a.get("/analytics/analytics/business_overview/"),getFinancialSummary:()=>a.get("/analytics/analytics/financial_summary/"),getOperationalMetrics:()=>a.get("/analytics/analytics/operational_metrics/"),getCustomerInsights:()=>a.get("/analytics/analytics/customer_insights/"),getInventoryInsights:()=>a.get("/analytics/analytics/inventory_insights/")},h=a}}]);
//# sourceMappingURL=260.41c7ee01.chunk.js.map