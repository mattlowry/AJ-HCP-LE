"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[757],{6291:(e,t,i)=>{i.d(t,{Ay:()=>h,LP:()=>m,S:()=>l,Up:()=>c,dr:()=>o,l:()=>d,pO:()=>u});var a=i(9722),r=i(4703);const n=a.A.create({baseURL:"http://localhost:8000/api",headers:{"Content-Type":"application/json"},timeout:1e4});n.interceptors.request.use((e=>{var t;e.metadata={startTime:performance.now()};const i=localStorage.getItem("authToken");i&&(e.headers.Authorization="Bearer ".concat(i)),e.headers["X-Requested-With"]="XMLHttpRequest";const a=null===(t=document.querySelector('meta[name="csrf-token"]'))||void 0===t?void 0:t.getAttribute("content");return a&&(e.headers["X-CSRF-Token"]=a),e}),(e=>(r.Fk.handleError(e,{component:"APIService",action:"Request Interceptor",userMessage:"Failed to prepare API request"}),Promise.reject(e)))),n.interceptors.response.use((e=>{var t;const i=e.config,a=performance.now()-((null===(t=i.metadata)||void 0===t?void 0:t.startTime)||0);var n,s;a>2e3&&(console.warn("\u26a0\ufe0f Slow API call: ".concat(null===(n=e.config.method)||void 0===n?void 0:n.toUpperCase()," ").concat(e.config.url," took ").concat(Math.round(a),"ms")),r.Fk.handleError(new Error("Slow API response"),{component:"APIService",action:"Slow Response: ".concat(null===(s=e.config.method)||void 0===s?void 0:s.toUpperCase()," ").concat(e.config.url),userMessage:"API response was slower than expected"}));return e}),(async e=>{var t,a,o,c,l;r.Fk.handleError(e,{component:"APIService",action:"".concat(null===(t=e.config)||void 0===t||null===(a=t.method)||void 0===a?void 0:a.toUpperCase()," ").concat(null===(o=e.config)||void 0===o?void 0:o.url),userMessage:s(e)});if(401===(null===(c=e.response)||void 0===c?void 0:c.status)){const{authService:t}=await i.e(422).then(i.bind(i,1422)),a=await t.refreshToken();if(a&&e.config)return e.config.headers.Authorization="Bearer ".concat(a),n.request(e.config);t.logout()}if(429===(null===(l=e.response)||void 0===l?void 0:l.status)){const t=e.response.headers["retry-after"],i=t?1e3*parseInt(t):1e3;return console.warn("Rate limited. Retrying after ".concat(i,"ms")),new Promise(((t,a)=>{setTimeout((()=>{e.config?n.request(e.config).then(t).catch(a):a(e)}),i)}))}return Promise.reject(e)}));const s=e=>{if(!e.response)return"Network connection error. Please check your internet connection.";const t=e.response.status,i=e.response.data;switch(t){case 400:return(null===i||void 0===i?void 0:i.message)||"Invalid request. Please check your input.";case 401:return"Your session has expired. Please log in again.";case 403:return"You do not have permission to perform this action.";case 404:return"The requested resource was not found.";case 422:return(null===i||void 0===i?void 0:i.message)||"Please check your input and try again.";case 429:return"Too many requests. Please wait a moment and try again.";case 500:return"Server error occurred. Our team has been notified.";case 502:case 503:case 504:return"Service temporarily unavailable. Please try again later.";default:return(null===i||void 0===i?void 0:i.message)||"An unexpected error occurred. Please try again."}},o={getAll:e=>n.get("/customers/",{params:e}),getById:e=>n.get("/customers/".concat(e,"/")),create:e=>n.post("/customers/",e),update:(e,t)=>n.put("/customers/".concat(e,"/"),t),delete:e=>n.delete("/customers/".concat(e,"/")),getProperties:e=>n.get("/customers/".concat(e,"/properties/")),addProperty:(e,t)=>n.post("/customers/".concat(e,"/add_property/"),t),getContacts:e=>n.get("/customers/".concat(e,"/contacts/")),addContact:(e,t)=>n.post("/customers/".concat(e,"/add_contact/"),t),getReviews:e=>n.get("/customers/".concat(e,"/reviews/")),addReview:(e,t)=>n.post("/customers/".concat(e,"/add_review/"),t)},c={getAll:e=>n.get("/properties/",{params:e}),getById:e=>n.get("/properties/".concat(e,"/")),create:e=>n.post("/properties/",e),update:(e,t)=>n.put("/properties/".concat(e,"/"),t),delete:e=>n.delete("/properties/".concat(e,"/"))},l={getAll:e=>n.get("/jobs/",{params:e}),getById:e=>n.get("/jobs/".concat(e,"/")),create:e=>n.post("/jobs/",e),update:(e,t)=>n.put("/jobs/".concat(e,"/"),t),delete:e=>n.delete("/jobs/".concat(e,"/")),updateStatus:(e,t)=>n.patch("/jobs/".concat(e,"/update_status/"),{status:t}),assignTechnicians:(e,t)=>n.patch("/jobs/".concat(e,"/assign_technicians/"),{technician_ids:t})},d={getAll:e=>n.get("/jobs/technicians/",{params:e}),getAvailable:e=>n.get("/jobs/technicians/available/",{params:e}),getById:e=>n.get("/jobs/technicians/".concat(e,"/"))},u={getItems:e=>n.get("/inventory/items/",{params:e}),getItemById:e=>n.get("/inventory/items/".concat(e,"/")),createItem:e=>n.post("/inventory/items/",e),updateItem:(e,t)=>n.put("/inventory/items/".concat(e,"/"),t),deleteItem:e=>n.delete("/inventory/items/".concat(e,"/")),adjustStock:(e,t,i)=>n.post("/inventory/items/".concat(e,"/adjust_stock/"),{quantity:t,reason:i}),getCategories:()=>n.get("/inventory/categories/"),createCategory:e=>n.post("/inventory/categories/",e),getSuppliers:()=>n.get("/inventory/suppliers/"),createSupplier:e=>n.post("/inventory/suppliers/",e),getStockMovements:e=>n.get("/inventory/stock-movements/",{params:e}),getPurchaseOrders:e=>n.get("/inventory/purchase-orders/",{params:e}),createPurchaseOrder:e=>n.post("/inventory/purchase-orders/",e),updatePurchaseOrder:(e,t)=>n.put("/inventory/purchase-orders/".concat(e,"/"),t)},m={getBusinessOverview:()=>n.get("/analytics/analytics/business_overview/"),getFinancialSummary:()=>n.get("/analytics/analytics/financial_summary/"),getOperationalMetrics:()=>n.get("/analytics/analytics/operational_metrics/"),getCustomerInsights:()=>n.get("/analytics/analytics/customer_insights/"),getInventoryInsights:()=>n.get("/analytics/analytics/inventory_insights/")},h=n},6773:(e,t,i)=>{i.d(t,{_5:()=>s,fr:()=>n,jr:()=>a,l:()=>r,n4:()=>o});i(5043);const a=(e,t)=>t.required&&(!e||"string"===typeof e&&""===e.trim())?"This field is required":e?t.minLength&&"string"===typeof e&&e.length<t.minLength?"Must be at least ".concat(t.minLength," characters"):t.maxLength&&"string"===typeof e&&e.length>t.maxLength?"Must be no more than ".concat(t.maxLength," characters"):t.pattern&&"string"===typeof e&&!t.pattern.test(e)?"Invalid format":t.min&&"number"===typeof e&&e<t.min?"Must be at least ".concat(t.min):t.max&&"number"===typeof e&&e>t.max?"Must be no more than ".concat(t.max):t.custom?t.custom(e):null:null,r=(e,t)=>{const i={};for(const[r,n]of Object.entries(t)){const t=a(e[r],n);t&&(i[r]=t)}return{isValid:0===Object.keys(i).length,errors:i}},n={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^[\+]?[1-9][\d]{0,15}$/,phoneUS:/^(\+1)?[\s\-]?\(?([0-9]{3})\)?[\s\-]?([0-9]{3})[\s\-]?([0-9]{4})$/,postalCode:/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,zipCode:/^\d{5}(-\d{4})?$/,url:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,alphanumeric:/^[a-zA-Z0-9]+$/,currency:/^\d+(\.\d{1,2})?$/,jobNumber:/^JOB-\d{4}-\d{4}$/,invoiceNumber:/^INV-\d{4}-\d{4}$/,strongPassword:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/},s={required:e=>({required:!0,custom:t=>!t||"string"===typeof t&&""===t.trim()?e||"This field is required":null}),minLength:(e,t)=>({minLength:e,custom:i=>i&&i.length<e?t||"Must be at least ".concat(e," characters"):null}),maxLength:(e,t)=>({maxLength:e,custom:i=>i&&i.length>e?t||"Must be no more than ".concat(e," characters"):null}),email:e=>({pattern:n.email,custom:t=>t&&!n.email.test(t)?e||"Please enter a valid email address":null}),phone:e=>({pattern:n.phoneUS,custom:t=>t&&!n.phoneUS.test(t)?e||"Please enter a valid phone number (e.g., (555) 123-4567)":null}),emailRule:{required:!0,pattern:n.email,custom:e=>e&&!n.email.test(e)?"Please enter a valid email address":null},phoneRule:{required:!0,pattern:n.phoneUS,custom:e=>e&&!n.phoneUS.test(e)?"Please enter a valid phone number (e.g., (555) 123-4567)":null},currencyRule:{required:!0,min:0,custom:e=>void 0!==e&&e<0?"Amount cannot be negative":null},currency:{required:!0,min:0,custom:e=>void 0!==e&&e<0?"Amount cannot be negative":null},duration:{required:!0,min:.5,max:24,custom:e=>void 0!==e&&(e<.5||e>24)?"Duration must be between 0.5 and 24 hours":null},postalCode:{pattern:n.postalCode,custom:e=>!e||n.postalCode.test(e)||n.zipCode.test(e)?null:"Please enter a valid postal/zip code"},strongPassword:{required:!0,minLength:8,pattern:n.strongPassword,custom:e=>e&&!n.strongPassword.test(e)?"Password must contain at least 8 characters with uppercase, lowercase, number, and special character":null},customerName:{required:!0,minLength:2,maxLength:100,custom:e=>e&&e.trim().length<2?"Name must be at least 2 characters":null},address:{required:!0,minLength:10,maxLength:255,custom:e=>e&&e.trim().length<10?"Please enter a complete address":null},description:{required:!0,minLength:10,maxLength:1e3,custom:e=>e&&e.trim().length<10?"Description must be at least 10 characters":null}},o=e=>{const t=e.replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):11===t.length&&"1"===t[0]?"+1 (".concat(t.slice(1,4),") ").concat(t.slice(4,7),"-").concat(t.slice(7)):e}},8757:(e,t,i)=>{i.r(t),i.d(t,{default:()=>se});var a=i(2555),r=i(5043),n=i(6291),s=i(6773),o=i(2110),c=i(6494),l=i(6446),d=i(5865),u=i(3845),m=i(1637),h=i(8903),p=i(1045),g=i(1828),x=i(8983),y=i(9336),A=i(7392),_=i(1906),j=i(7784),b=i(7254),f=i(9958),v=i(3933),S=i(9216),C=i(3336),w=i(2008),k=i(4010),E=i(35),W=i(6600),B=i(5316),P=i(3193),q=i(9190),I=i(2221),L=i(2143),D=i(9347),T=i(9509),F=i(1209),R=i(8807),M=i(4503),N=i(9737),O=i(529),H=i(2252),z=i(6772),G=i(7423),J=i(9484),U=i(7805),Q=i(141),V=i(5337),$=i(8606),Z=i(7225),K=i(8883),Y=i(8970),X=i(1387),ee=i(8262),te=i(1794),ie=i(3585),ae=i(1648),re=i(1024),ne=i(579);const se=()=>{const[e,t]=(0,r.useState)([]),[i,se]=(0,r.useState)([]),[oe,ce]=(0,r.useState)(!0),[le,de]=(0,r.useState)(null),[ue,me]=(0,r.useState)((new Date).toISOString().split("T")[0]),[he,pe]=(0,r.useState)("week"),[ge,xe]=(0,r.useState)([]),[ye,Ae]=(0,r.useState)(new Date),[_e,je]=(0,r.useState)({}),[be,fe]=(0,r.useState)([]),[ve,Se]=(0,r.useState)(!1),[Ce,we]=(0,r.useState)(null),[ke,Ee]=(0,r.useState)(null),[We,Be]=(0,r.useState)(!1),[Pe,qe]=(0,r.useState)(""),[Ie,Le]=(0,r.useState)("all"),[De,Te]=(0,r.useState)("all"),[Fe,Re]=(0,r.useState)(!1),[Me,Ne]=(0,r.useState)({title:"",customer_name:"",service_type_name:"",priority:"medium",estimated_duration:2,description:"",customer_id:null,job_type:"job",labor_rate:125,material_markup:20,subtotal:0,tax_rate:8.25,total_cost:0}),[Oe,He]=(0,r.useState)([]),[ze,Ge]=(0,r.useState)({description:"",quantity:1,unit_price:0,type:"labor"}),[Je,Ue]=(0,r.useState)(!1),[Qe,Ve]=(0,r.useState)(""),[$e,Ze]=(0,r.useState)({}),[Ke,Ye]=(0,r.useState)([]),[Xe,et]=(0,r.useState)([]),[tt,it]=(0,r.useState)(!1),[at,rt]=(0,r.useState)([]),nt=e=>{switch(e){case"emergency":return"#d32f2f";case"high":return"#ed6c02";case"medium":return"#2e7d32";default:return"#757575"}},st=e.filter((e=>{const t=!Pe||e.title.toLowerCase().includes(Pe.toLowerCase())||e.customer_name.toLowerCase().includes(Pe.toLowerCase())||e.service_type_name.toLowerCase().includes(Pe.toLowerCase()),i="all"===Ie||e.status===Ie,a="all"===De||e.priority===De;return t&&i&&a})),[ot,ct]=(0,r.useState)(!1),[lt,dt]=(0,r.useState)(""),[ut,mt]=(0,r.useState)([]),[ht,pt]=(0,r.useState)([]),[gt,xt]=(0,r.useState)(null),[yt,At]=(0,r.useState)({first_name:"",last_name:"",email:"",phone:"",street_address:"",city:"",state:"",zip_code:"",customer_type:"residential"}),_t=(0,ie.FR)((0,ie.MS)(ie.AN,{activationConstraint:{distance:8}})),jt=()=>{const e=[];for(let t=7;t<=19;t++)e.push({time:"".concat(t.toString().padStart(2,"0"),":00"),jobs:[]}),t<19&&e.push({time:"".concat(t.toString().padStart(2,"0"),":30"),jobs:[]});return e},[bt,ft]=(0,r.useState)(jt());(0,r.useEffect)((()=>{const e=["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffc107","#ff9800","#ff5722"],t={};i.forEach(((i,a)=>{t[i.id]=e[a%e.length]})),je(t)}),[i]),(0,r.useEffect)((()=>{const e=[],t=new Date(ye);t.setDate(t.getDate()-t.getDay());for(let i=0;i<7;i++){const a=new Date(t);a.setDate(t.getDate()+i),e.push(a.toISOString().split("T")[0])}xe(e)}),[ye]);const vt=r.useCallback((async()=>{let e,i;ce(!0),de(null),"week"===he&&ge.length>0?(e=ge[0],i=ge[6]):(e=ue,i=ue);try{throw new Error("Using demo data")}catch(a){console.error("Error fetching scheduled jobs:",a);const e=new Date,i=t=>{const i=new Date(e);return i.setDate(i.getDate()+t),i.toISOString().split("T")[0]},r=[{id:"101",job_number:"JOB-2024-0101",title:"Panel Replacement",customer_name:"John Smith",status:"scheduled",priority:"high",scheduled_date:i(0),scheduled_start_time:"09:00",scheduled_end_time:"12:00",assigned_technician:"1",estimated_duration:3,service_type_name:"Panel Installation",job_type:"job",estimated_cost:3500},{id:"102",job_number:"EST-2024-0102",title:"Outlet Repair",customer_name:"Sarah Davis",status:"on_the_way",priority:"medium",scheduled_date:i(0),scheduled_start_time:"14:00",scheduled_end_time:"15:30",assigned_technician:"2",estimated_duration:1.5,service_type_name:"Electrical Repair",job_type:"estimate",estimated_cost:250,estimate_status:"sent"},{id:"103",job_number:"JOB-2024-0103",title:"Emergency Power Outage",customer_name:"Robert Brown",status:"in_progress",priority:"emergency",scheduled_date:i(1),scheduled_start_time:"10:00",scheduled_end_time:"13:00",assigned_technician:"1",estimated_duration:3,service_type_name:"Emergency Service",job_type:"job",estimated_cost:500},{id:"104",job_number:"JOB-2024-0104",title:"Lighting Installation",customer_name:"Lisa Garcia",status:"scheduled",priority:"low",scheduled_date:i(1),scheduled_start_time:"15:00",scheduled_end_time:"17:00",assigned_technician:"3",estimated_duration:2,service_type_name:"Lighting Installation"},{id:"105",job_number:"JOB-2024-0105",title:"Ceiling Fan Installation",customer_name:"Mark Johnson",status:"scheduled",priority:"medium",scheduled_date:i(2),scheduled_start_time:"09:00",scheduled_end_time:"11:00",assigned_technician:"2",estimated_duration:2,service_type_name:"Installation"},{id:"106",job_number:"JOB-2024-0106",title:"Wiring Upgrade",customer_name:"Jennifer Wilson",status:"scheduled",priority:"high",scheduled_date:i(3),scheduled_start_time:"13:00",scheduled_end_time:"17:00",assigned_technician:"1",assigned_technicians:["1","2"],estimated_duration:4,service_type_name:"Wiring Installation",job_type:"job",estimated_cost:2800},{id:"107",job_number:"JOB-2024-0107",title:"Security Light Install",customer_name:"David Miller",status:"completed",priority:"medium",scheduled_date:i(4),scheduled_start_time:"10:00",scheduled_end_time:"12:00",assigned_technician:"3",estimated_duration:2,service_type_name:"Lighting Installation",job_type:"job",estimated_cost:800,payment_status:"paid"},{id:"108",job_number:"JOB-2024-0108",title:"Breaker Replacement",customer_name:"Anna Garcia",status:"completed",priority:"high",scheduled_date:i(3),scheduled_start_time:"11:00",scheduled_end_time:"12:30",assigned_technician:"2",estimated_duration:1.5,service_type_name:"Electrical Repair",job_type:"job",estimated_cost:450,payment_status:"due"}];t(r)}try{throw new Error("Using demo data")}catch(r){console.error("Error fetching unscheduled jobs:",r);fe([{id:"201",job_number:"JOB-2024-0201",title:"Electric Vehicle Charger",customer_name:"Thomas Edwards",status:"pending",priority:"high",scheduled_date:null,scheduled_start_time:null,scheduled_end_time:null,assigned_technician:null,estimated_duration:4,service_type_name:"Installation",job_type:"job",estimated_cost:2500},{id:"202",job_number:"EST-2024-0202",title:"Flickering Lights",customer_name:"Emily Parker",status:"pending",priority:"medium",scheduled_date:null,scheduled_start_time:null,scheduled_end_time:null,assigned_technician:null,estimated_duration:1,service_type_name:"Electrical Repair",job_type:"estimate",estimated_cost:350,estimate_status:"viewed"},{id:"203",job_number:"EST-2024-0203",title:"Hot Tub Wiring",customer_name:"Kevin Thompson",status:"pending",priority:"low",scheduled_date:null,scheduled_start_time:null,scheduled_end_time:null,assigned_technician:null,estimated_duration:5,service_type_name:"Wiring Installation",job_type:"estimate",estimated_cost:1200,estimate_status:"draft"},{id:"204",job_number:"JOB-2024-0204",title:"Main Panel Upgrade",customer_name:"Michelle Davis",status:"pending",priority:"high",scheduled_date:null,scheduled_start_time:null,scheduled_end_time:null,assigned_technician:"1",assigned_technicians:["1","3"],estimated_duration:6,service_type_name:"Panel Installation",job_type:"job",estimated_cost:4500}])}ce(!1)}),[ue,he,ge]);(0,r.useEffect)((()=>{vt(),(async()=>{try{de(null);const e=await n.l.getAvailable();se(e.data)}catch(le){console.error("Error fetching technicians:",le),de("Failed to load technicians"),se([{id:"1",full_name:"Mike Johnson",skill_level:"Senior",is_available:!0,employee_id:"T-101"},{id:"2",full_name:"Tom Wilson",skill_level:"Journeyman",is_available:!0,employee_id:"T-102"},{id:"3",full_name:"Steve Miller",skill_level:"Apprentice",is_available:!0,employee_id:"T-103"}])}})(),(async()=>{try{it(!0),de(null);const e=await n.pO.getItems({is_active:!0}),t=await n.pO.getCategories();Ye(e.data.results),et(t.data);const i=e.data.results.filter((e=>e.current_stock<=e.minimum_stock));rt(i)}catch(le){console.error("Error fetching inventory:",le),de("Failed to load inventory. Using fallback materials catalog."),Ye([]),et([]),rt([])}finally{it(!1)}})()}),[vt]),(0,r.useEffect)((()=>{const t=jt();e.forEach((e=>{if(e.scheduled_start_time){const[i,a]=e.scheduled_start_time.split(":"),r=parseInt(i),n=parseInt(a),s=t.findIndex((t=>t.time===e.scheduled_start_time));if(s>=0)t[s].jobs.push(e);else{const i=60*r+n;let a=0,s=1/0;t.forEach(((e,t)=>{const[r,n]=e.time.split(":").map(Number),o=60*r+n,c=Math.abs(i-o);c<s&&(s=c,a=t)})),t[a].jobs.push(e)}}})),ft(t)}),[e]);const St=e=>"estimate"===e?"\ud83d\udccb":"\ud83d\udd27",Ct=e=>{switch(e){case"draft":return"#9e9e9e";case"sent":return"#2196f3";case"viewed":return"#ff9800";case"approved":return"#4caf50";case"rejected":return"#f44336";case"expired":return"#795548";default:return"#e0e0e0"}},wt=e=>{switch(e){case"draft":default:return"Draft";case"sent":return"Sent";case"viewed":return"Viewed";case"approved":return"Approved";case"rejected":return"Rejected";case"expired":return"Expired"}},kt=e=>{let{job:t}=e;const{attributes:i,listeners:r,setNodeRef:n,transform:s,transition:m}=(0,ae.gl)({id:t.id}),h={transform:re.Ks.Transform.toString(s),transition:m};return(0,ne.jsx)(o.A,(0,a.A)((0,a.A)((0,a.A)({ref:n,style:h},i),r),{},{sx:{margin:1,cursor:"grab",borderLeft:"4px solid ".concat(nt(t.priority)),border:(p=t.job_type,"estimate"===p?"2px dashed":"2px solid"),borderColor:"estimate"===t.job_type?"#ff9800":"transparent","&:hover":{boxShadow:3}},onClick:()=>{we(t),Be(!1),Se(!0)},children:(0,ne.jsxs)(c.A,{sx:{padding:"8px !important"},children:[(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,ne.jsx)(d.A,{variant:"body2",sx:{fontSize:"0.8rem"},children:St(t.job_type)}),(0,ne.jsx)(d.A,{variant:"caption",color:"textSecondary",children:t.job_number}),"estimate"===t.job_type&&(0,ne.jsx)(u.A,{label:wt(t.estimate_status),size:"small",sx:{backgroundColor:Ct(t.estimate_status),color:"white",fontSize:"0.6rem",height:16}})]}),(0,ne.jsx)(d.A,{variant:"body2",fontWeight:"bold",children:t.title}),(0,ne.jsx)(d.A,{variant:"caption",children:t.customer_name}),(0,ne.jsxs)(l.A,{sx:{display:"flex",gap:.5,mt:.5},children:[(0,ne.jsx)(u.A,{label:t.priority,size:"small",sx:{backgroundColor:nt(t.priority),color:"white",fontSize:"0.7rem",height:20}}),t.service_type_name&&(0,ne.jsx)(u.A,{label:t.service_type_name,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20}})]})]})}));var p},Et=e=>new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),Wt=async(e,i)=>{try{console.log("Updating job ".concat(e," status to ").concat(i)),"on_the_way"===i&&await Bt(e),t((t=>t.map((t=>t.id===e?(0,a.A)((0,a.A)({},t),{},{status:i}):t)))),Ce&&Ce.id===e&&we((0,a.A)((0,a.A)({},Ce),{},{status:i})),Se(!1),we(null)}catch(le){console.error("Error updating job status:",le),alert("Error updating job status")}},Bt=async t=>{try{const a=e.find((e=>e.id===t))||Ce;if(!a)throw new Error("Job not found");const r=(e=>{const t=e.assigned_technicians||(e.assigned_technician?[e.assigned_technician]:[]);return 0===t.length?"Unassigned":t.map((e=>{const t=i.find((t=>t.id===e));return t?t.full_name:"Unknown"})).join(", ")})(a).split(",")[0].trim(),n=Math.floor(30*Math.random())+10,s=n-2,o=n+8,c="".concat(r," from AJ Long Electric is on the way to your home, and should arrive in ").concat(s,"-").concat(o," mins.");console.log("SMS Message:",c),console.log("Sending to customer:",a.customer_name),alert("SMS sent to ".concat(a.customer_name,':\n\n"').concat(c,'"'))}catch(le){console.error("Error sending on-the-way notification:",le),alert("Error sending notification")}},Pt=async e=>{Ne((0,a.A)((0,a.A)({},Me),{},{customer_id:e.id,customer_name:e.full_name})),dt(e.full_name),ct(!1),await qt(e.id)},qt=async e=>{try{const t=await n.dr.getProperties(e);pt(t.data||[]),t.data&&1===t.data.length?xt(t.data[0].id):xt(null)}catch(le){console.error("Error fetching customer properties:",le);pt([{id:1,property_type:"single_family",street_address:"123 Main St",city:"Springfield",state:"IL",zip_code:"62701",full_address:"123 Main St, Springfield, IL 62701"},{id:2,property_type:"commercial",street_address:"456 Business Ave",city:"Springfield",state:"IL",zip_code:"62702",full_address:"456 Business Ave, Springfield, IL 62702"}]),xt(null)}},It=e=>{const t=e.reduce(((e,t)=>e+t.total),0),i=t*Me.tax_rate/100,r=t+i;Ne((e=>(0,a.A)((0,a.A)({},e),{},{subtotal:t,total_cost:r})))};r.useEffect((()=>{It(Oe)}),[Me.tax_rate]);const Lt=[{id:"sqd-qo115",name:"Square D QO 15A Single Pole Breaker",category:"Circuit Breakers - Square D",price:14.98,unit:"each"},{id:"sqd-qo120",name:"Square D QO 20A Single Pole Breaker",category:"Circuit Breakers - Square D",price:16.47,unit:"each"},{id:"sqd-qo130",name:"Square D QO 30A Single Pole Breaker",category:"Circuit Breakers - Square D",price:22.98,unit:"each"},{id:"sqd-qo240",name:"Square D QO 40A Double Pole Breaker",category:"Circuit Breakers - Square D",price:45.97,unit:"each"},{id:"sqd-qo250",name:"Square D QO 50A Double Pole Breaker",category:"Circuit Breakers - Square D",price:58.76,unit:"each"},{id:"sqd-qo2100",name:"Square D QO 100A Double Pole Breaker",category:"Circuit Breakers - Square D",price:125.99,unit:"each"},{id:"sqd-qo120gfi",name:"Square D QO 20A GFCI Breaker",category:"Circuit Breakers - Square D",price:89.97,unit:"each"},{id:"sqd-qo115af",name:"Square D QO 15A AFCI Breaker",category:"Circuit Breakers - Square D",price:75.98,unit:"each"},{id:"sqd-qo120df",name:"Square D QO 20A Dual Function AFCI/GFCI",category:"Circuit Breakers - Square D",price:125.99,unit:"each"},{id:"sie-q115",name:"Siemens Q115 15A Single Pole Breaker",category:"Circuit Breakers - Siemens",price:12.48,unit:"each"},{id:"sie-q120",name:"Siemens Q120 20A Single Pole Breaker",category:"Circuit Breakers - Siemens",price:13.97,unit:"each"},{id:"sie-q130",name:"Siemens Q130 30A Single Pole Breaker",category:"Circuit Breakers - Siemens",price:19.98,unit:"each"},{id:"sie-q240",name:"Siemens Q240 40A Double Pole Breaker",category:"Circuit Breakers - Siemens",price:39.97,unit:"each"},{id:"sie-q250",name:"Siemens Q250 50A Double Pole Breaker",category:"Circuit Breakers - Siemens",price:52.76,unit:"each"},{id:"sie-q120gfci",name:"Siemens Q120GFCI 20A GFCI Breaker",category:"Circuit Breakers - Siemens",price:79.97,unit:"each"},{id:"sie-q115af",name:"Siemens Q115AF 15A AFCI Breaker",category:"Circuit Breakers - Siemens",price:69.98,unit:"each"},{id:"ge-thql115",name:"GE THQL115 15A Single Pole Breaker",category:"Circuit Breakers - GE",price:11.98,unit:"each"},{id:"ge-thql120",name:"GE THQL120 20A Single Pole Breaker",category:"Circuit Breakers - GE",price:13.47,unit:"each"},{id:"ge-thql130",name:"GE THQL130 30A Single Pole Breaker",category:"Circuit Breakers - GE",price:18.98,unit:"each"},{id:"ge-thql240",name:"GE THQL240 40A Double Pole Breaker",category:"Circuit Breakers - GE",price:37.97,unit:"each"},{id:"ge-thql250",name:"GE THQL250 50A Double Pole Breaker",category:"Circuit Breakers - GE",price:49.76,unit:"each"},{id:"ge-thql1120gf",name:"GE THQL1120GF 20A GFCI Breaker",category:"Circuit Breakers - GE",price:77.97,unit:"each"},{id:"eat-br115",name:"Eaton BR115 15A Single Pole Breaker",category:"Circuit Breakers - Eaton",price:10.98,unit:"each"},{id:"eat-br120",name:"Eaton BR120 20A Single Pole Breaker",category:"Circuit Breakers - Eaton",price:12.47,unit:"each"},{id:"eat-br130",name:"Eaton BR130 30A Single Pole Breaker",category:"Circuit Breakers - Eaton",price:17.98,unit:"each"},{id:"eat-br240",name:"Eaton BR240 40A Double Pole Breaker",category:"Circuit Breakers - Eaton",price:35.97,unit:"each"},{id:"eat-br250",name:"Eaton BR250 50A Double Pole Breaker",category:"Circuit Breakers - Eaton",price:47.76,unit:"each"},{id:"eat-brgf120",name:"Eaton BRGF120 20A GFCI Breaker",category:"Circuit Breakers - Eaton",price:75.97,unit:"each"},{id:"romex-14-2-wg",name:"14-2 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:.89,unit:"foot"},{id:"romex-14-3-wg",name:"14-3 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:1.29,unit:"foot"},{id:"romex-12-2-wg",name:"12-2 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:1.39,unit:"foot"},{id:"romex-12-3-wg",name:"12-3 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:1.89,unit:"foot"},{id:"romex-10-2-wg",name:"10-2 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:2.49,unit:"foot"},{id:"romex-10-3-wg",name:"10-3 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:3.29,unit:"foot"},{id:"romex-8-2-wg",name:"8-2 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:3.89,unit:"foot"},{id:"romex-8-3-wg",name:"8-3 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:4.89,unit:"foot"},{id:"romex-6-2-wg",name:"6-2 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:5.89,unit:"foot"},{id:"romex-6-3-wg",name:"6-3 Romex NM-B Cable w/Ground",category:"Wire & Cable - Romex",price:7.29,unit:"foot"},{id:"thhn-14-black",name:"14 AWG THHN/THWN Stranded Black",category:"Wire & Cable - THHN",price:.45,unit:"foot"},{id:"thhn-14-white",name:"14 AWG THHN/THWN Stranded White",category:"Wire & Cable - THHN",price:.45,unit:"foot"},{id:"thhn-14-red",name:"14 AWG THHN/THWN Stranded Red",category:"Wire & Cable - THHN",price:.45,unit:"foot"},{id:"thhn-12-black",name:"12 AWG THHN/THWN Stranded Black",category:"Wire & Cable - THHN",price:.65,unit:"foot"},{id:"thhn-12-white",name:"12 AWG THHN/THWN Stranded White",category:"Wire & Cable - THHN",price:.65,unit:"foot"},{id:"thhn-12-red",name:"12 AWG THHN/THWN Stranded Red",category:"Wire & Cable - THHN",price:.65,unit:"foot"},{id:"thhn-10-black",name:"10 AWG THHN/THWN Stranded Black",category:"Wire & Cable - THHN",price:.95,unit:"foot"},{id:"thhn-10-white",name:"10 AWG THHN/THWN Stranded White",category:"Wire & Cable - THHN",price:.95,unit:"foot"},{id:"thhn-8-black",name:"8 AWG THHN/THWN Stranded Black",category:"Wire & Cable - THHN",price:1.45,unit:"foot"},{id:"thhn-6-black",name:"6 AWG THHN/THWN Stranded Black",category:"Wire & Cable - THHN",price:2.15,unit:"foot"},{id:"rec-15a-std",name:"15A Standard Duplex Receptacle",category:"Outlets & Receptacles",price:1.48,unit:"each"},{id:"rec-20a-std",name:"20A Standard Duplex Receptacle",category:"Outlets & Receptacles",price:2.98,unit:"each"},{id:"rec-15a-gfci",name:"15A GFCI Receptacle",category:"Outlets & Receptacles",price:18.97,unit:"each"},{id:"rec-20a-gfci",name:"20A GFCI Receptacle",category:"Outlets & Receptacles",price:22.97,unit:"each"},{id:"rec-15a-usb",name:"15A USB-A Duplex Receptacle",category:"Outlets & Receptacles",price:24.98,unit:"each"},{id:"rec-15a-usbc",name:"15A USB-C Duplex Receptacle",category:"Outlets & Receptacles",price:34.98,unit:"each"},{id:"rec-20a-usb",name:"20A USB-A Duplex Receptacle",category:"Outlets & Receptacles",price:29.98,unit:"each"},{id:"rec-gfci-usb",name:"20A GFCI with USB Charging",category:"Outlets & Receptacles",price:39.97,unit:"each"},{id:"rec-smartwifi",name:"Smart WiFi GFCI Receptacle",category:"Outlets & Receptacles",price:49.98,unit:"each"},{id:"rec-weatherproof",name:"Weatherproof GFCI Receptacle",category:"Outlets & Receptacles",price:26.98,unit:"each"},{id:"sw-single-toggle",name:"Single Pole Toggle Switch",category:"Switches",price:1.98,unit:"each"},{id:"sw-single-decora",name:"Single Pole Decora Switch",category:"Switches",price:3.48,unit:"each"},{id:"sw-3way-toggle",name:"3-Way Toggle Switch",category:"Switches",price:3.98,unit:"each"},{id:"sw-3way-decora",name:"3-Way Decora Switch",category:"Switches",price:5.48,unit:"each"},{id:"sw-4way-toggle",name:"4-Way Toggle Switch",category:"Switches",price:12.98,unit:"each"},{id:"sw-dimmer-led",name:"LED Dimmer Switch",category:"Switches",price:24.98,unit:"each"},{id:"sw-dimmer-3way",name:"3-Way LED Dimmer Switch",category:"Switches",price:34.98,unit:"each"},{id:"sw-smart-wifi",name:"Smart WiFi Switch",category:"Switches",price:19.98,unit:"each"},{id:"sw-smart-dimmer",name:"Smart WiFi Dimmer Switch",category:"Switches",price:39.98,unit:"each"},{id:"sw-motion-sensor",name:"Motion Sensor Switch",category:"Switches",price:29.98,unit:"each"},{id:"sw-timer",name:"Programmable Timer Switch",category:"Switches",price:22.98,unit:"each"},{id:"box-1gang-pvc",name:"Single Gang PVC Old Work Box",category:"Electrical Boxes",price:1.48,unit:"each"},{id:"box-2gang-pvc",name:"Double Gang PVC Old Work Box",category:"Electrical Boxes",price:2.98,unit:"each"},{id:"box-3gang-pvc",name:"Triple Gang PVC Old Work Box",category:"Electrical Boxes",price:4.98,unit:"each"},{id:"box-1gang-metal",name:"Single Gang Metal Box",category:"Electrical Boxes",price:2.48,unit:"each"},{id:"box-2gang-metal",name:"Double Gang Metal Box",category:"Electrical Boxes",price:3.98,unit:"each"},{id:"box-ceiling-pvc",name:"Ceiling Fan PVC Box",category:"Electrical Boxes",price:3.98,unit:"each"},{id:"box-ceiling-metal",name:"Ceiling Fan Metal Box",category:"Electrical Boxes",price:5.98,unit:"each"},{id:"box-4x4-sq",name:'4" x 4" Square Junction Box',category:"Electrical Boxes",price:3.48,unit:"each"},{id:"box-4x4-oct",name:'4" Octagon Ceiling Box',category:"Electrical Boxes",price:2.98,unit:"each"},{id:"box-weatherproof",name:"Weatherproof Outdoor Box",category:"Electrical Boxes",price:8.98,unit:"each"},{id:"conduit-emt-12",name:'1/2" EMT Electrical Conduit',category:"Conduit & Fittings",price:3.48,unit:"foot"},{id:"conduit-emt-34",name:'3/4" EMT Electrical Conduit',category:"Conduit & Fittings",price:4.98,unit:"foot"},{id:"conduit-emt-1",name:'1" EMT Electrical Conduit',category:"Conduit & Fittings",price:6.98,unit:"foot"},{id:"conduit-pvc-12",name:'1/2" PVC Schedule 40 Conduit',category:"Conduit & Fittings",price:2.48,unit:"foot"},{id:"conduit-pvc-34",name:'3/4" PVC Schedule 40 Conduit',category:"Conduit & Fittings",price:3.48,unit:"foot"},{id:"conduit-pvc-1",name:'1" PVC Schedule 40 Conduit',category:"Conduit & Fittings",price:4.98,unit:"foot"},{id:"fitting-emt-conn-12",name:'1/2" EMT Connector',category:"Conduit & Fittings",price:1.98,unit:"each"},{id:"fitting-emt-conn-34",name:'3/4" EMT Connector',category:"Conduit & Fittings",price:2.98,unit:"each"},{id:"fitting-emt-coup-12",name:'1/2" EMT Coupling',category:"Conduit & Fittings",price:1.48,unit:"each"},{id:"fitting-90-12",name:'1/2" 90\xb0 EMT Elbow',category:"Conduit & Fittings",price:2.98,unit:"each"},{id:"panel-sqd-qo120",name:"Square D QO 20-Circuit Load Center 120/240V",category:"Electrical Panels",price:189,unit:"each"},{id:"panel-sqd-qo140",name:"Square D QO 40-Circuit Load Center 120/240V",category:"Electrical Panels",price:298,unit:"each"},{id:"panel-sqd-qo200",name:"Square D QO 200A 40-Circuit Main Breaker Panel",category:"Electrical Panels",price:445,unit:"each"},{id:"panel-sie-s2040",name:"Siemens 40-Circuit Load Center 120/240V",category:"Electrical Panels",price:185,unit:"each"},{id:"panel-sie-200a",name:"Siemens 200A 40-Circuit Main Breaker Panel",category:"Electrical Panels",price:425,unit:"each"},{id:"panel-ge-load",name:"GE PowerMark 40-Circuit Load Center",category:"Electrical Panels",price:175,unit:"each"},{id:"subpanel-100a",name:"100A Sub Panel Load Center",category:"Electrical Panels",price:125,unit:"each"},{id:"led-recessed-4",name:'4" LED Recessed Downlight',category:"Lighting & Fixtures",price:12.98,unit:"each"},{id:"led-recessed-6",name:'6" LED Recessed Downlight',category:"Lighting & Fixtures",price:18.98,unit:"each"},{id:"led-recessed-adj",name:'6" LED Adjustable Recessed Light',category:"Lighting & Fixtures",price:24.98,unit:"each"},{id:"fixture-flush-led",name:"LED Flush Mount Ceiling Light",category:"Lighting & Fixtures",price:39.98,unit:"each"},{id:"fixture-pendant",name:"Mini Pendant Light Fixture",category:"Lighting & Fixtures",price:29.98,unit:"each"},{id:"fixture-chandelier",name:"Traditional Chandelier 5-Light",category:"Lighting & Fixtures",price:129,unit:"each"},{id:"fixture-vanity",name:"3-Light Vanity Bar Fixture",category:"Lighting & Fixtures",price:59.98,unit:"each"},{id:"fixture-outdoor",name:"Outdoor Wall Lantern",category:"Lighting & Fixtures",price:34.98,unit:"each"},{id:"under-cabinet-led",name:"Under Cabinet LED Light Strip",category:"Lighting & Fixtures",price:24.98,unit:"each"},{id:"smoke-detector-battery",name:"Battery Smoke Detector",category:"Specialty & Safety",price:14.98,unit:"each"},{id:"smoke-detector-hardwired",name:"Hardwired Smoke Detector",category:"Specialty & Safety",price:22.98,unit:"each"},{id:"co-detector",name:"Carbon Monoxide Detector",category:"Specialty & Safety",price:29.98,unit:"each"},{id:"smoke-co-combo",name:"Smoke & CO Combo Detector",category:"Specialty & Safety",price:39.98,unit:"each"},{id:"surge-whole-house",name:"Whole House Surge Protector",category:"Specialty & Safety",price:189,unit:"each"},{id:"surge-strip",name:"8-Outlet Surge Protector Strip",category:"Specialty & Safety",price:24.98,unit:"each"},{id:"doorbell-wired",name:"Wired Doorbell Kit",category:"Specialty & Safety",price:19.98,unit:"each"},{id:"doorbell-smart",name:"Smart Video Doorbell",category:"Specialty & Safety",price:99.99,unit:"each"},{id:"exhaust-fan-bath",name:"Bathroom Exhaust Fan 80 CFM",category:"Specialty & Safety",price:29.98,unit:"each"},{id:"exhaust-fan-quiet",name:"Ultra-Quiet Bathroom Fan 110 CFM",category:"Specialty & Safety",price:79.98,unit:"each"},{id:"ev-charger-l2-32a",name:"32A Level 2 EV Charger",category:"EV Charging",price:499,unit:"each"},{id:"ev-charger-l2-40a",name:"40A Level 2 EV Charger",category:"EV Charging",price:649,unit:"each"},{id:"ev-charger-smart",name:"Smart WiFi EV Charger 32A",category:"EV Charging",price:699,unit:"each"},{id:"nema-6-50",name:"NEMA 6-50 50A 240V Receptacle",category:"EV Charging",price:24.98,unit:"each"},{id:"nema-14-50",name:"NEMA 14-50 50A 240V Receptacle",category:"EV Charging",price:29.98,unit:"each"},{id:"dryer-cord-4wire",name:"4-Wire 30A Dryer Cord",category:"EV Charging",price:34.98,unit:"each"},{id:"wirenut-yellow",name:"Yellow Wire Nuts (100 pack)",category:"Wire Nuts & Connectors",price:12.98,unit:"pack"},{id:"wirenut-red",name:"Red Wire Nuts (100 pack)",category:"Wire Nuts & Connectors",price:14.98,unit:"pack"},{id:"wirenut-blue",name:"Blue Wire Nuts (100 pack)",category:"Wire Nuts & Connectors",price:16.98,unit:"pack"},{id:"wirenut-orange",name:"Orange Wire Nuts (100 pack)",category:"Wire Nuts & Connectors",price:9.98,unit:"pack"},{id:"wago-221",name:"WAGO 221 Lever Connectors (25 pack)",category:"Wire Nuts & Connectors",price:24.98,unit:"pack"},{id:"wiremold-splice",name:"In-Line Splice Kit",category:"Wire Nuts & Connectors",price:8.98,unit:"each"},{id:"plate-1gang-white",name:"Single Gang Toggle Switch Plate - White",category:"Covers & Plates",price:.98,unit:"each"},{id:"plate-1gang-almond",name:"Single Gang Toggle Switch Plate - Almond",category:"Covers & Plates",price:1.28,unit:"each"},{id:"plate-1gang-decora",name:"Single Gang Decora Switch Plate - White",category:"Covers & Plates",price:1.48,unit:"each"},{id:"plate-2gang-white",name:"Double Gang Switch Plate - White",category:"Covers & Plates",price:1.98,unit:"each"},{id:"plate-outlet-white",name:"Duplex Outlet Cover Plate - White",category:"Covers & Plates",price:.78,unit:"each"},{id:"plate-blank-white",name:"Blank Cover Plate - White",category:"Covers & Plates",price:.98,unit:"each"},{id:"plate-gfci-white",name:"GFCI Outlet Cover Plate - White",category:"Covers & Plates",price:1.98,unit:"each"}],Dt=[{min:0,max:25,markup:.5},{min:25.01,max:50,markup:.4},{min:50.01,max:100,markup:.35},{min:100.01,max:250,markup:.3},{min:250.01,max:500,markup:.25},{min:500.01,max:1/0,markup:.2}],Tt=e=>{const t=Dt.find((t=>e>=t.min&&e<=t.max));return t?e*(1+t.markup):1.35*e},Ft=e=>{const t=Dt.find((t=>e>=t.min&&e<=t.max));return t?100*t.markup:35},Rt=r.useMemo((()=>Ke.length>0?Ke.map((e=>({id:e.id.toString(),name:e.name,category:e.category_name||"General",price:Tt(e.cost_price||e.unit_price),unit:e.unit_of_measure,sku:e.sku,current_stock:e.current_stock,minimum_stock:e.minimum_stock,isLowStock:e.current_stock<=e.minimum_stock,description:e.description,costPrice:e.cost_price||e.unit_price,markupPercentage:Ft(e.cost_price||e.unit_price)}))):Lt.map((e=>(0,a.A)((0,a.A)({},e),{},{price:Tt(e.price),current_stock:void 0,minimum_stock:void 0,isLowStock:!1,sku:void 0,description:void 0,costPrice:e.price,markupPercentage:Ft(e.price)})))),[Ke]),Mt=async(e,t,i)=>{try{console.log("Material usage tracked: Item ".concat(e,", Quantity ").concat(t,", Type: ").concat(i));(new Date).toISOString();Ye((i=>i.map((i=>i.id===e?(0,a.A)((0,a.A)({},i),{},{pending_usage:(i.pending_usage||0)+t,available_stock:i.current_stock-((i.pending_usage||0)+t)}):i))))}catch(le){console.error("Error tracking material usage:",le)}},Nt=async(e,t,i)=>{try{const t=e.filter((e=>"material"===e.type&&e.inventory_item_id));if(0===t.length)return;console.log("Updating inventory for ".concat(t.length," items (").concat(i,")"));for(const e of t)try{Ye((t=>t.map((t=>{if(t.id===e.inventory_item_id){const i=Math.max(0,t.current_stock-e.quantity);return console.log("Updating item ".concat(t.name,": ").concat(t.current_stock," -> ").concat(i)),(0,a.A)((0,a.A)({},t),{},{current_stock:i,pending_usage:Math.max(0,(t.pending_usage||0)-e.quantity)})}return t})))),rt((t=>Ke.map((t=>{if(t.id===e.inventory_item_id){const i=Math.max(0,t.current_stock-e.quantity);return(0,a.A)((0,a.A)({},t),{},{current_stock:i})}return t})).filter((e=>e.current_stock<=e.minimum_stock))))}catch(r){console.error("Error updating inventory for item ".concat(e.inventory_item_id,":"),r)}}catch(le){console.error("Error updating inventory quantities:",le)}},Ot=async(i,r)=>{try{console.log("Updating estimate ".concat(i," status to ").concat(r)),t((e=>e.map((e=>e.id===i?(0,a.A)((0,a.A)({},e),{},{estimate_status:r}):e)))),fe((e=>e.map((e=>e.id===i?(0,a.A)((0,a.A)({},e),{},{estimate_status:r}):e)))),Ce&&Ce.id===i&&we((0,a.A)((0,a.A)({},Ce),{},{estimate_status:r}));const n={draft:"Estimate saved as draft",sent:"Estimate sent to customer via email",viewed:"Customer has viewed the estimate",approved:"Estimate approved by customer!",rejected:"Estimate rejected by customer",expired:"Estimate has expired"};if(n[r]&&alert(n[r]),"approved"===r){const t=e.find((e=>e.id===i))||be.find((e=>e.id===i));t&&t.line_items&&await Nt(t.line_items,0,"estimate_approved")}}catch(le){console.error("Error updating estimate status:",le),alert("Error updating estimate status")}};return oe?(0,ne.jsxs)(l.A,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[(0,ne.jsx)(m.A,{size:40,sx:{mb:2}}),(0,ne.jsx)(d.A,{variant:"h6",color:"textSecondary",children:"Loading scheduling data..."})]}):(0,ne.jsxs)(l.A,{sx:{minHeight:"100vh",backgroundColor:"#f8fafc",p:3},children:[(0,ne.jsxs)(l.A,{sx:{mb:4},children:[(0,ne.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,ne.jsxs)(l.A,{children:[(0,ne.jsx)(d.A,{variant:"h4",fontWeight:"600",color:"text.primary",gutterBottom:!0,children:"Schedule Manager"}),(0,ne.jsx)(d.A,{variant:"body1",color:"text.secondary",children:"Manage jobs, schedules, and technician assignments"})]}),(0,ne.jsxs)(h.Ay,{container:!0,spacing:2,sx:{width:"auto",minWidth:400},children:[(0,ne.jsx)(h.Ay,{item:!0,children:(0,ne.jsxs)(o.A,{sx:{p:2,textAlign:"center",minWidth:120},children:[(0,ne.jsx)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,ne.jsx)(p.A,{sx:{bgcolor:"#e3f2fd",color:"#1976d2",width:32,height:32},children:(0,ne.jsx)(T.A,{fontSize:"small"})})}),(0,ne.jsx)(d.A,{variant:"h6",fontWeight:"600",children:e.length}),(0,ne.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"Total Jobs"})]})}),(0,ne.jsx)(h.Ay,{item:!0,children:(0,ne.jsxs)(o.A,{sx:{p:2,textAlign:"center",minWidth:120},children:[(0,ne.jsx)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,ne.jsx)(p.A,{sx:{bgcolor:"#fff3e0",color:"#ed6c02",width:32,height:32},children:(0,ne.jsx)(F.A,{fontSize:"small"})})}),(0,ne.jsx)(d.A,{variant:"h6",fontWeight:"600",children:be.length}),(0,ne.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"Unscheduled"})]})}),(0,ne.jsx)(h.Ay,{item:!0,children:(0,ne.jsxs)(o.A,{sx:{p:2,textAlign:"center",minWidth:120},children:[(0,ne.jsx)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:1},children:(0,ne.jsx)(p.A,{sx:{bgcolor:"#ffebee",color:"#d32f2f",width:32,height:32},children:(0,ne.jsx)(R.A,{fontSize:"small"})})}),(0,ne.jsx)(d.A,{variant:"h6",fontWeight:"600",children:e.filter((e=>"emergency"===e.priority)).length}),(0,ne.jsx)(d.A,{variant:"caption",color:"text.secondary",children:"Emergency"})]})})]})]}),(0,ne.jsx)(o.A,{sx:{p:2,mb:3},children:(0,ne.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,ne.jsxs)(g.A,{value:he,exclusive:!0,onChange:(e,t)=>t&&pe(t),size:"small",children:[(0,ne.jsxs)(x.A,{value:"day","aria-label":"day view",children:[(0,ne.jsx)(M.A,{fontSize:"small"}),(0,ne.jsx)(d.A,{variant:"body2",sx:{ml:1},children:"Day"})]}),(0,ne.jsxs)(x.A,{value:"week","aria-label":"week view",children:[(0,ne.jsx)(N.A,{fontSize:"small"}),(0,ne.jsx)(d.A,{variant:"body2",sx:{ml:1},children:"Week"})]}),(0,ne.jsxs)(x.A,{value:"list","aria-label":"list view",children:[(0,ne.jsx)(O.A,{fontSize:"small"}),(0,ne.jsx)(d.A,{variant:"body2",sx:{ml:1},children:"List"})]})]}),(0,ne.jsx)(y.A,{orientation:"vertical",flexItem:!0}),(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ne.jsx)(A.A,{size:"small",onClick:()=>{const e=new Date(ye);e.setDate(e.getDate()-7),Ae(e)},children:(0,ne.jsx)(H.A,{})}),(0,ne.jsx)(d.A,{variant:"h6",fontWeight:"500",sx:{minWidth:200,textAlign:"center"},children:"week"===he?"Week of ".concat(Et(ge[0]||ue)):Et(ue)}),(0,ne.jsx)(A.A,{size:"small",onClick:()=>{const e=new Date(ye);e.setDate(e.getDate()+7),Ae(e)},children:(0,ne.jsx)(z.A,{})})]}),(0,ne.jsx)(_.A,{variant:"outlined",size:"small",onClick:()=>{const e=new Date;me(e.toISOString().split("T")[0]),Ae(e)},startIcon:(0,ne.jsx)(G.A,{}),children:"Today"})]}),(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ne.jsx)(j.A,{size:"small",placeholder:"Search jobs...",value:Pe,onChange:e=>qe(e.target.value),InputProps:{startAdornment:(0,ne.jsx)(J.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}})},sx:{width:200}}),(0,ne.jsx)(A.A,{size:"small",onClick:()=>{Re(!0),vt().finally((()=>Re(!1)))},disabled:Fe,children:(0,ne.jsx)(U.A,{className:Fe?"animate-spin":""})}),(0,ne.jsx)(_.A,{variant:"outlined",startIcon:(0,ne.jsx)(Q.A,{}),onClick:()=>{we(null),Be(!0),Ne((e=>(0,a.A)((0,a.A)({},e),{},{job_type:"job"}))),Se(!0)},children:"New Job"}),(0,ne.jsx)(_.A,{variant:"contained",startIcon:(0,ne.jsx)(V.A,{}),onClick:()=>{we(null),Be(!0),Ne((e=>(0,a.A)((0,a.A)({},e),{},{job_type:"estimate"}))),Se(!0)},children:"New Estimate"})]})]})})]}),le&&(0,ne.jsx)(b.A,{severity:"error",sx:{mb:3},children:le}),"list"===he?(0,ne.jsxs)(o.A,{sx:{p:3},children:[(0,ne.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"All Jobs"}),(0,ne.jsx)(h.Ay,{container:!0,spacing:2,children:st.map((e=>(0,ne.jsx)(h.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,ne.jsxs)(o.A,{sx:{p:2,borderLeft:"4px solid ".concat(nt(e.priority)),cursor:"pointer","&:hover":{elevation:4}},onClick:()=>{we(e),Se(!0)},children:[(0,ne.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,ne.jsx)(d.A,{variant:"subtitle1",fontWeight:"600",children:e.title}),(0,ne.jsx)(u.A,{size:"small",label:e.priority,color:"emergency"===e.priority?"error":"high"===e.priority?"warning":"default"})]}),(0,ne.jsx)(d.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.customer_name}),(0,ne.jsx)(d.A,{variant:"caption",color:"text.secondary",children:e.scheduled_date?Et(e.scheduled_date):"Unscheduled"})]})},e.id)))})]}):(0,ne.jsxs)(ie.Mp,{sensors:_t,onDragStart:t=>{const i=be.find((e=>e.id===t.active.id))||e.find((e=>e.id===t.active.id));Ee(i||null)},onDragEnd:async r=>{const{active:s,over:o}=r;if(Ee(null),o&&o.id.toString().startsWith("technician-")){const r=o.id.toString().split("-"),c=r.indexOf("technician")+1,l=r.indexOf("time")+1,d=r.indexOf("date")+1,u=r[c],m=r[l];let h=ue;d>0&&r[d]&&(h=r[d]);try{const e=parseInt(s.id.toString());let t=u;"any"===u&&i.length>0&&(t=i[0].id);const a={assigned_to:[parseInt(t)],scheduled_start:"".concat(h,"T").concat(m,":00"),status:"scheduled"};await n.S.update(e,a),console.log("Job assignment successful:",{jobId:s.id,technicianId:t,scheduleDate:h,timeSlot:m}),await vt()}catch(le){console.error("Error assigning job:",le),console.log("Using demo mode - updating local state");const n=be.find((e=>e.id===s.id.toString()))||e.find((e=>e.id===s.id.toString()));if(n){let e=u;"any"===u&&i.length>0&&(e=i[0].id);const r=(0,a.A)((0,a.A)({},n),{},{assigned_technician:e,scheduled_date:h,scheduled_start_time:m,status:"scheduled"});fe((e=>e.filter((e=>e.id!==s.id.toString())))),t((e=>[...e.filter((e=>e.id!==s.id.toString())),r]))}}}},children:[(0,ne.jsxs)(h.Ay,{container:!0,spacing:3,children:[(0,ne.jsx)(h.Ay,{item:!0,xs:12,lg:3,children:(0,ne.jsxs)(o.A,{sx:{height:"fit-content"},children:[(0,ne.jsx)(f.A,{title:(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ne.jsx)(F.A,{color:"warning"}),(0,ne.jsx)(d.A,{variant:"h6",children:"Unscheduled Jobs"}),(0,ne.jsx)(v.A,{badgeContent:be.length,color:"warning"})]})}),(0,ne.jsx)(c.A,{sx:{pt:0},children:(0,ne.jsx)(ae.gB,{items:be.map((e=>e.id)),strategy:ae._G,children:(0,ne.jsxs)(S.A,{spacing:1,sx:{minHeight:200},children:[be.map((e=>(0,ne.jsx)(kt,{job:e},e.id))),0===be.length&&(0,ne.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:4,color:"text.secondary"},children:[(0,ne.jsx)($.A,{sx:{fontSize:48,mb:1,opacity:.5}}),(0,ne.jsx)(d.A,{variant:"body2",children:"All jobs scheduled!"})]})]})})})]})}),(0,ne.jsx)(h.Ay,{item:!0,xs:12,lg:9,children:(0,ne.jsxs)(o.A,{sx:{overflow:"hidden"},children:[(0,ne.jsx)(f.A,{title:(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ne.jsx)(Z.A,{color:"primary"}),(0,ne.jsx)(d.A,{variant:"h6",children:"week"===he?"Weekly Schedule":"Daily Schedule"})]}),action:(0,ne.jsx)(l.A,{sx:{display:"flex",gap:1},children:(0,ne.jsx)(u.A,{size:"small",label:"".concat(e.filter((e=>e.scheduled_date===ue)).length," jobs today"),color:"primary",variant:"outlined"})})}),(0,ne.jsx)(c.A,{sx:{p:0},children:oe?(0,ne.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,ne.jsx)(m.A,{})}):(0,ne.jsx)(C.A,{sx:{overflow:"auto",maxHeight:"70vh"},children:(0,ne.jsx)(l.A,{sx:{minWidth:"week"===he?1e3:400},children:(0,ne.jsx)(d.A,{variant:"body2",sx:{p:2,textAlign:"center",color:"text.secondary"},children:"Calendar view will be rendered here"})})})})]})})]}),(0,ne.jsx)(ie.Hd,{children:ke?(0,ne.jsx)(o.A,{sx:{borderLeft:"4px solid ".concat(nt(ke.priority)),opacity:.8},children:(0,ne.jsxs)(c.A,{children:[(0,ne.jsx)(d.A,{variant:"subtitle2",children:ke.title}),(0,ne.jsx)(d.A,{variant:"body2",color:"text.secondary",children:ke.customer_name})]})}):null})]}),(0,ne.jsx)(w.A,{in:!0,children:(0,ne.jsx)(k.A,{color:"primary","aria-label":"add job",sx:{position:"fixed",bottom:16,right:16,zIndex:1e3},onClick:()=>{we(null),Be(!0),Ne((e=>(0,a.A)((0,a.A)({},e),{},{job_type:"job"}))),Se(!0)},children:(0,ne.jsx)(Q.A,{})})}),(0,ne.jsxs)(E.A,{open:ve,onClose:()=>{Se(!1),Be(!1),we(null)},maxWidth:"md",fullWidth:!0,children:[(0,ne.jsx)(W.A,{children:We?"Create New ".concat("estimate"===Me.job_type?"Estimate":"Job"):Ce?"Job Details: ".concat(Ce.job_number):"Job Details"}),(0,ne.jsx)(B.A,{children:We?(0,ne.jsxs)(h.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"".concat("estimate"===Me.job_type?"Estimate":"Job"," Title"),value:Me.title,onChange:e=>Ne((0,a.A)((0,a.A)({},Me),{},{title:e.target.value})),required:!0})}),(0,ne.jsxs)(h.Ay,{item:!0,xs:12,children:[(0,ne.jsxs)(l.A,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[(0,ne.jsx)(j.A,{fullWidth:!0,label:"Search Customer",value:lt,onChange:e=>{dt(e.target.value),e.target.value.length>2&&async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{const t=await n.dr.getAll(e?{search:e}:{});mt(t.data.results||[])}catch(le){console.error("Error fetching customers:",le),mt([{id:1,full_name:"John Smith",email:"john@example.com",phone:"+12025551234"},{id:2,full_name:"Sarah Davis",email:"sarah@example.com",phone:"+12025551235"},{id:3,full_name:"Mike Johnson",email:"mike@example.com",phone:"+12025551236"}])}}(e.target.value)},placeholder:"Type customer name...",helperText:Me.customer_id?"Customer selected":"Search existing customers or add new"}),(0,ne.jsx)(_.A,{variant:"outlined",onClick:()=>ct(!0),sx:{mb:2.5,minWidth:"auto",px:2},children:"+ New"})]}),lt&&ut.length>0&&!Me.customer_id&&(0,ne.jsx)(l.A,{sx:{mt:1,maxHeight:200,overflow:"auto"},children:ut.filter((e=>e.full_name.toLowerCase().includes(lt.toLowerCase()))).map((e=>(0,ne.jsxs)(l.A,{sx:{p:1,border:"1px solid #e0e0e0",borderRadius:1,mb:.5,cursor:"pointer","&:hover":{backgroundColor:"#f5f5f5"}},onClick:()=>Pt(e),children:[(0,ne.jsx)(d.A,{variant:"body2",fontWeight:"bold",children:e.full_name}),(0,ne.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:[e.email," \u2022 ",e.phone]})]},e.id)))})]}),ot&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsxs)(d.A,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:["\ud83d\udc64 Add New Customer",(0,ne.jsx)(_.A,{size:"small",onClick:()=>ct(!1),children:"Cancel"})]})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"First Name",value:yt.first_name,onChange:e=>At((0,a.A)((0,a.A)({},yt),{},{first_name:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Last Name",value:yt.last_name,onChange:e=>At((0,a.A)((0,a.A)({},yt),{},{last_name:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Email",type:"email",value:yt.email,onChange:e=>At((0,a.A)((0,a.A)({},yt),{},{email:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Phone",value:yt.phone,onChange:e=>At((0,a.A)((0,a.A)({},yt),{},{phone:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Street Address",value:yt.street_address,onChange:e=>At((0,a.A)((0,a.A)({},yt),{},{street_address:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:4,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"City",value:yt.city,onChange:e=>At((0,a.A)((0,a.A)({},yt),{},{city:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:4,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"State",value:yt.state,onChange:e=>At((0,a.A)((0,a.A)({},yt),{},{state:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:4,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"ZIP Code",value:yt.zip_code,onChange:e=>At((0,a.A)((0,a.A)({},yt),{},{zip_code:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsx)(_.A,{variant:"contained",onClick:async()=>{try{const e=(await n.dr.create(yt)).data;mt((t=>[e,...t])),Pt(e),At({first_name:"",last_name:"",email:"",phone:"",street_address:"",city:"",state:"",zip_code:"",customer_type:"residential"}),alert("Customer created successfully!")}catch(le){console.error("Error creating customer:",le),alert("Error creating customer")}},disabled:!yt.first_name||!yt.last_name||!yt.email,fullWidth:!0,children:"Create Customer & Select"})})]}),Me.customer_id&&ht.length>0&&(0,ne.jsxs)(h.Ay,{item:!0,xs:12,children:[(0,ne.jsxs)(P.A,{fullWidth:!0,required:!0,children:[(0,ne.jsx)(q.A,{children:"Select Property"}),(0,ne.jsx)(I.A,{value:gt||"",label:"Select Property",onChange:e=>xt(Number(e.target.value)),children:ht.map((e=>{var t;return(0,ne.jsx)(L.A,{value:e.id,children:(0,ne.jsxs)(l.A,{children:[(0,ne.jsx)(d.A,{variant:"body2",fontWeight:"bold",children:e.full_address||"".concat(e.street_address,", ").concat(e.city,", ").concat(e.state," ").concat(e.zip_code)}),(0,ne.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:[null===(t=e.property_type)||void 0===t?void 0:t.replace("_"," ").replace(/\b\w/g,(e=>e.toUpperCase())),e.square_footage&&" \u2022 ".concat(e.square_footage.toLocaleString()," sq ft")]})]})},e.id)}))})]}),ht.length>1&&!gt&&(0,ne.jsx)(d.A,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:"Please select a property for this job"})]}),(0,ne.jsx)(h.Ay,{item:!0,xs:12,sm:6,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Service Type",value:Me.service_type_name,onChange:e=>Ne((0,a.A)((0,a.A)({},Me),{},{service_type_name:e.target.value})),required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:12,sm:6,children:(0,ne.jsxs)(P.A,{fullWidth:!0,required:!0,children:[(0,ne.jsx)(q.A,{children:"Priority"}),(0,ne.jsxs)(I.A,{value:Me.priority,label:"Priority",onChange:e=>Ne((0,a.A)((0,a.A)({},Me),{},{priority:e.target.value})),children:[(0,ne.jsx)(L.A,{value:"low",children:"Low"}),(0,ne.jsx)(L.A,{value:"medium",children:"Medium"}),(0,ne.jsx)(L.A,{value:"high",children:"High"}),(0,ne.jsx)(L.A,{value:"emergency",children:"Emergency"})]})]})}),(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Estimated Duration (hours)",type:"number",value:Me.estimated_duration,onChange:e=>Ne((0,a.A)((0,a.A)({},Me),{},{estimated_duration:parseInt(e.target.value)||1})),inputProps:{min:.5,max:12,step:.5},required:!0})}),(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Description",multiline:!0,rows:4,value:Me.description,onChange:e=>Ne((0,a.A)((0,a.A)({},Me),{},{description:e.target.value}))})}),"estimate"===Me.job_type&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsx)(d.A,{variant:"h6",sx:{mt:2,mb:1,display:"flex",alignItems:"center",gap:1},children:"\ud83d\udcb0 Estimate Pricing & Line Items"})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Labor Rate ($/hour)",type:"number",value:Me.labor_rate,onChange:e=>Ne((0,a.A)((0,a.A)({},Me),{},{labor_rate:parseFloat(e.target.value)||0})),inputProps:{min:0,step:5}})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsx)(j.A,{fullWidth:!0,label:"Tax Rate (%)",type:"number",value:Me.tax_rate,onChange:e=>Ne((0,a.A)((0,a.A)({},Me),{},{tax_rate:parseFloat(e.target.value)||0})),inputProps:{min:0,max:15,step:.25}})}),(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsxs)(C.A,{sx:{p:2,bgcolor:"#f5f5f5"},children:[(0,ne.jsx)(d.A,{variant:"subtitle1",gutterBottom:!0,children:"Add Line Item"}),(0,ne.jsxs)(h.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,ne.jsx)(h.Ay,{item:!0,xs:12,sm:4,children:(0,ne.jsx)(j.A,{fullWidth:!0,size:"small",label:"Description",value:ze.description,onChange:e=>Ge((0,a.A)((0,a.A)({},ze),{},{description:e.target.value})),placeholder:"e.g., Electrical outlet installation"})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,sm:2,children:(0,ne.jsxs)(P.A,{fullWidth:!0,size:"small",children:[(0,ne.jsx)(q.A,{children:"Type"}),(0,ne.jsxs)(I.A,{value:ze.type,label:"Type",onChange:e=>Ge((0,a.A)((0,a.A)({},ze),{},{type:e.target.value})),children:[(0,ne.jsx)(L.A,{value:"labor",children:"Labor"}),(0,ne.jsx)(L.A,{value:"material",children:"Material"}),(0,ne.jsx)(L.A,{value:"service",children:"Service"})]})]})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,sm:2,children:(0,ne.jsx)(j.A,{fullWidth:!0,size:"small",label:"Quantity",type:"number",value:ze.quantity,onChange:e=>Ge((0,a.A)((0,a.A)({},ze),{},{quantity:parseInt(e.target.value)||1})),inputProps:{min:1}})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,sm:2,children:(0,ne.jsx)(j.A,{fullWidth:!0,size:"small",label:"Unit Price ($)",type:"number",value:ze.unit_price,onChange:e=>Ge((0,a.A)((0,a.A)({},ze),{},{unit_price:parseFloat(e.target.value)||0})),inputProps:{min:0,step:.01}})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,sm:1.5,children:(0,ne.jsx)(_.A,{fullWidth:!0,variant:"contained",onClick:()=>{if(!ze.description||ze.unit_price<=0)return void alert("Please enter a description and valid unit price");const e={id:Date.now().toString(),description:ze.description,quantity:ze.quantity,unit_price:ze.unit_price,total:ze.quantity*ze.unit_price,type:ze.type};He((t=>[...t,e])),Ge({description:"",quantity:1,unit_price:0,type:"labor"}),It([...Oe,e])},startIcon:(0,ne.jsx)(K.A,{}),disabled:!ze.description||ze.unit_price<=0,children:"Add"})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,sm:1.5,children:(0,ne.jsx)(_.A,{fullWidth:!0,variant:"outlined",onClick:()=>Ue(!0),startIcon:(0,ne.jsx)(Y.A,{}),size:"small",children:"Parts"})})]})]})}),Oe.length>0&&(0,ne.jsx)(h.Ay,{item:!0,xs:12,children:(0,ne.jsxs)(C.A,{sx:{p:2},children:[(0,ne.jsx)(d.A,{variant:"subtitle1",gutterBottom:!0,children:"Line Items"}),Oe.map((e=>(0,ne.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:1,border:"1px solid #e0e0e0",borderRadius:1,mb:1,bgcolor:"labor"===e.type?"#e3f2fd":"material"===e.type?"#f3e5f5":"#e8f5e8"},children:[(0,ne.jsxs)(l.A,{sx:{flex:1},children:[(0,ne.jsx)(d.A,{variant:"body2",fontWeight:"bold",children:e.description}),(0,ne.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:[e.type.charAt(0).toUpperCase()+e.type.slice(1)," \u2022 Qty: ",e.quantity," \xd7 $",e.unit_price.toFixed(2)]})]}),(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ne.jsxs)(d.A,{variant:"body2",fontWeight:"bold",children:["$",e.total.toFixed(2)]}),(0,ne.jsx)(A.A,{size:"small",color:"error",onClick:()=>(e=>{const t=Oe.filter((t=>t.id!==e));He(t),It(t)})(e.id),children:(0,ne.jsx)(X.A,{fontSize:"small"})})]})]},e.id))),(0,ne.jsxs)(l.A,{sx:{mt:2,pt:2,borderTop:"2px solid #e0e0e0"},children:[(0,ne.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,ne.jsx)(d.A,{variant:"body2",children:"Subtotal:"}),(0,ne.jsxs)(d.A,{variant:"body2",children:["$",Me.subtotal.toFixed(2)]})]}),(0,ne.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,ne.jsxs)(d.A,{variant:"body2",children:["Tax (",Me.tax_rate,"%):"]}),(0,ne.jsxs)(d.A,{variant:"body2",children:["$",(Me.subtotal*Me.tax_rate/100).toFixed(2)]})]}),(0,ne.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,ne.jsx)(d.A,{variant:"h6",fontWeight:"bold",children:"Total:"}),(0,ne.jsxs)(d.A,{variant:"h6",fontWeight:"bold",color:"primary",children:["$",Me.total_cost.toFixed(2)]})]})]})]})})]})]}):Ce?(0,ne.jsxs)(h.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,ne.jsxs)(h.Ay,{item:!0,xs:12,children:[(0,ne.jsx)(d.A,{variant:"h6",children:Ce.title}),(0,ne.jsxs)(d.A,{color:"textSecondary",children:["Customer: ",Ce.customer_name]})]}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsxs)(d.A,{variant:"body2",children:[(0,ne.jsx)("strong",{children:"Status:"})," ",Ce.status]})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsxs)(d.A,{variant:"body2",children:[(0,ne.jsx)("strong",{children:"Priority:"})," ",Ce.priority]})}),"estimate"===Ce.job_type&&(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsxs)(d.A,{variant:"body2",children:[(0,ne.jsx)("strong",{children:"Estimate Status:"})," ",(0,ne.jsx)(u.A,{label:wt(Ce.estimate_status),size:"small",sx:{backgroundColor:Ct(Ce.estimate_status),color:"white",fontSize:"0.7rem",height:20,ml:1}})]})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsxs)(d.A,{variant:"body2",children:[(0,ne.jsx)("strong",{children:"Service:"})," ",Ce.service_type_name]})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsxs)(d.A,{variant:"body2",children:[(0,ne.jsx)("strong",{children:"Duration:"})," ",Ce.estimated_duration,"h"]})}),Ce.scheduled_date&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsxs)(d.A,{variant:"body2",children:[(0,ne.jsx)("strong",{children:"Date:"})," ",Ce.scheduled_date]})}),(0,ne.jsx)(h.Ay,{item:!0,xs:6,children:(0,ne.jsxs)(d.A,{variant:"body2",children:[(0,ne.jsx)("strong",{children:"Time:"})," ",Ce.scheduled_start_time," - ",Ce.scheduled_end_time]})})]})]}):null}),(0,ne.jsxs)(D.A,{children:[(0,ne.jsx)(_.A,{onClick:()=>{Se(!1),Be(!1),we(null)},children:"Cancel"}),We?(0,ne.jsxs)(_.A,{variant:"contained",color:"primary",onClick:async()=>{try{const e={title:{required:!0,minLength:3,maxLength:100},customer_name:s._5.customerName,service_type_name:{required:!0,minLength:2},estimated_duration:s._5.duration,description:{required:!0,minLength:5,maxLength:500}},t=(0,s.l)(Me,e);if(!t.isValid)return void alert("Please fix the following errors:\n"+Object.values(t.errors).join("\n"));const i="estimate"===Me.job_type?"EST":"JOB",r="estimate"===Me.job_type?Me.total_cost:Me.estimated_duration*Me.labor_rate,o=(0,a.A)({job_number:"".concat(i,"-").concat(Date.now()),title:Me.title,description:Me.description,customer:Me.customer_id||1,property:gt||1,service_type:Me.service_type_name||"General Service",priority:Me.priority,status:"pending",estimated_duration:Me.estimated_duration,estimated_cost:r,assigned_to:[]},"estimate"===Me.job_type&&{job_type:"estimate",labor_rate:Me.labor_rate,tax_rate:Me.tax_rate,line_items:Oe,subtotal:Me.subtotal,total_cost:Me.total_cost,estimate_status:"draft"});if(await n.S.create(o),"job"===Me.job_type){"job-".concat(Date.now());await Nt(Oe,0,"job_created")}const c="estimate"===Me.job_type?"Estimate created successfully! Total: $".concat(Me.total_cost.toFixed(2)):"Job created successfully!";alert(c),vt(),Se(!1),Be(!1)}catch(le){console.error("Error creating job:",le),alert("Error creating job. Check console for details.")}},disabled:!Me.title||!Me.customer_name||!Me.service_type_name||"estimate"===Me.job_type&&0===Oe.length||ht.length>1&&!gt,children:["Create ","estimate"===Me.job_type?"Estimate":"Job"]}):Ce?(0,ne.jsxs)(l.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:["estimate"===Ce.job_type&&(0,ne.jsxs)(ne.Fragment,{children:["draft"===Ce.estimate_status&&(0,ne.jsx)(_.A,{variant:"contained",color:"primary",onClick:()=>(async t=>{try{var i;const a=e.find((e=>e.id===t))||be.find((e=>e.id===t));if(!a)throw new Error("Estimate not found");console.log("Sending estimate ".concat(t," to customer"));const r="Dear ".concat(a.customer_name,",\n\nThank you for choosing AJ Long Electric for your electrical needs.\n\nPlease find your estimate attached:\n- Estimate #: ").concat(a.job_number,"\n- Service: ").concat(a.title,"\n- Total Cost: $").concat((null===(i=a.estimated_cost)||void 0===i?void 0:i.toFixed(2))||"0.00","\n\nThis estimate is valid for 30 days from the date of issue.\n\nTo approve this estimate, please reply to this email or call us at (555) 123-4567.\n\nBest regards,\nAJ Long Electric Team");alert("Email sent to ".concat(a.customer_name,":\n\n").concat(r)),Ot(t,"sent")}catch(le){console.error("Error sending estimate:",le),alert("Error sending estimate")}})(Ce.id),startIcon:(0,ne.jsx)(ee.A,{}),children:"\ud83d\udce7 Send Estimate"}),("sent"===Ce.estimate_status||"viewed"===Ce.estimate_status)&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(_.A,{variant:"contained",color:"success",onClick:()=>Ot(Ce.id,"approved"),startIcon:(0,ne.jsx)($.A,{}),children:"\u2705 Mark Approved"}),(0,ne.jsx)(_.A,{variant:"outlined",color:"error",onClick:()=>Ot(Ce.id,"rejected"),startIcon:(0,ne.jsx)(te.A,{}),children:"\u274c Mark Rejected"})]}),"approved"===Ce.estimate_status&&(0,ne.jsx)(_.A,{variant:"contained",color:"secondary",onClick:()=>(async t=>{try{const i=e.find((e=>e.id===t))||be.find((e=>e.id===t));if(!i||"estimate"!==i.job_type)throw new Error("Estimate not found");console.log("Converting estimate ".concat(t," to job"));const r=(0,a.A)((0,a.A)({},i),{},{id:"job-".concat(Date.now()),job_number:i.job_number.replace("EST-","JOB-"),job_type:"job",status:"pending",estimate_status:void 0});fe((e=>[r,...e])),i.line_items&&await Nt(i.line_items,r.id,"job_created"),Ot(t,"approved"),alert("Estimate converted to Job ".concat(r.job_number)),Se(!1),we(null)}catch(le){console.error("Error converting estimate to job:",le),alert("Error converting estimate to job")}})(Ce.id),startIcon:(0,ne.jsx)(V.A,{}),children:"\ud83d\udd04 Convert to Job"}),(0,ne.jsx)(_.A,{variant:"outlined",color:"warning",onClick:()=>Ot(Ce.id,"expired"),children:"\u23f0 Mark Expired"})]}),"job"===Ce.job_type&&"scheduled"===Ce.status&&(0,ne.jsx)(_.A,{variant:"contained",color:"warning",onClick:()=>Wt(Ce.id,"on_the_way"),sx:{backgroundColor:"#ff9800"},children:"\ud83d\udcf1 On The Way"}),"job"===Ce.job_type&&"on_the_way"===Ce.status&&(0,ne.jsx)(_.A,{variant:"contained",color:"success",onClick:()=>Wt(Ce.id,"in_progress"),children:"\u25b6\ufe0f Start Job"}),"job"===Ce.job_type&&"in_progress"===Ce.status&&(0,ne.jsx)(_.A,{variant:"contained",color:"primary",onClick:()=>Wt(Ce.id,"completed"),children:"\u2705 Finish Job"}),"job"===Ce.job_type&&"completed"===Ce.status&&"paid"!==Ce.payment_status&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(_.A,{variant:"contained",color:"secondary",onClick:()=>(async i=>{try{const r=e.find((e=>e.id===i))||Ce;if(!r)return;console.log("Sending invoice for job ".concat(i)),alert("Invoice sent to ".concat(r.customer_name," for $").concat(r.estimated_cost)),t((e=>e.map((e=>e.id===i?(0,a.A)((0,a.A)({},e),{},{payment_status:"due"}):e)))),Ce&&Ce.id===i&&we((0,a.A)((0,a.A)({},Ce),{},{payment_status:"due"}))}catch(le){console.error("Error sending invoice:",le),alert("Error sending invoice")}})(Ce.id),children:"\ud83d\udcb0 Send Invoice"}),(0,ne.jsx)(_.A,{variant:"outlined",color:"primary",onClick:()=>(async i=>{try{const r=e.find((e=>e.id===i))||Ce;if(!r)return;console.log("Collecting payment for job ".concat(i)),alert("Payment of $".concat(r.estimated_cost," collected from ").concat(r.customer_name)),t((e=>e.map((e=>e.id===i?(0,a.A)((0,a.A)({},e),{},{payment_status:"paid"}):e)))),Ce&&Ce.id===i&&we((0,a.A)((0,a.A)({},Ce),{},{payment_status:"paid"}))}catch(le){console.error("Error collecting payment:",le),alert("Error collecting payment")}})(Ce.id),children:"\ud83d\udcb3 Collect Payment"})]}),(0,ne.jsx)(_.A,{variant:"outlined",color:"inherit",children:"Edit Job"})]}):null]})]}),(0,ne.jsxs)(E.A,{open:Je,onClose:()=>Ue(!1),maxWidth:"lg",fullWidth:!0,children:[(0,ne.jsx)(W.A,{children:"\ud83d\udd27 Electrical Parts & Materials Catalog"}),(0,ne.jsxs)(B.A,{children:[(0,ne.jsx)(d.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Select materials to add to your estimate. Prices include standard markup."}),at.length>0&&(0,ne.jsxs)(b.A,{severity:"warning",sx:{mb:2},children:[(0,ne.jsx)("strong",{children:"Low Stock Alert:"})," ",at.length," item",at.length>1?"s":""," running low. Items: ",at.slice(0,3).map((e=>e.name)).join(", "),at.length>3&&" and ".concat(at.length-3," more"),"."]}),tt&&(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,ne.jsx)(m.A,{size:16}),(0,ne.jsx)(d.A,{variant:"caption",children:"Loading inventory data..."})]}),(0,ne.jsx)(j.A,{fullWidth:!0,placeholder:"Search materials...",value:Qe,onChange:e=>Ve(e.target.value),sx:{mb:2},size:"small"}),(0,ne.jsxs)(l.A,{sx:{mb:3,p:2,bgcolor:"grey.50",borderRadius:1},children:[(0,ne.jsx)(d.A,{variant:"body2",fontWeight:"bold",sx:{mb:1},children:"\ud83d\udcca Material Markup Tiers"}),(0,ne.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Dt.map(((e,t)=>(0,ne.jsx)(u.A,{label:"$".concat(0===e.min?"0":e.min.toFixed(2),"-").concat(e.max===1/0?"\u221e":"$"+e.max.toFixed(2),": ").concat((100*e.markup).toFixed(0),"%"),size:"small",variant:"outlined",sx:{fontSize:"11px"}},t)))}),(0,ne.jsx)(d.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Prices shown include automatic markup based on material cost"})]}),Array.from(new Set(Rt.filter((e=>""===Qe||e.name.toLowerCase().includes(Qe.toLowerCase())||e.category.toLowerCase().includes(Qe.toLowerCase()))).map((e=>e.category)))).map((e=>{const t=Rt.filter((t=>t.category===e)).filter((e=>""===Qe||e.name.toLowerCase().includes(Qe.toLowerCase())||e.category.toLowerCase().includes(Qe.toLowerCase())));return 0===t.length?null:(0,ne.jsxs)(l.A,{sx:{mb:3},children:[(0,ne.jsx)(d.A,{variant:"h6",gutterBottom:!0,sx:{color:"primary.main",borderBottom:"2px solid",borderColor:"primary.main",pb:.5,mb:2},children:e}),(0,ne.jsx)(h.Ay,{container:!0,spacing:1,children:t.map((e=>(0,ne.jsx)(h.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,ne.jsx)(o.A,{sx:{height:"100%",transition:"all 0.2s","&:hover":{transform:"translateY(-2px)",boxShadow:3}},children:(0,ne.jsxs)(c.A,{sx:{p:2},children:[(0,ne.jsx)(d.A,{variant:"body2",fontWeight:"bold",noWrap:!0,title:e.name,children:e.name}),(0,ne.jsxs)(d.A,{variant:"h6",color:"primary",sx:{mt:1},children:["$",e.price.toFixed(2)]}),(0,ne.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:["per ",e.unit]}),e.costPrice&&e.markupPercentage&&(0,ne.jsx)(l.A,{sx:{mt:.5},children:(0,ne.jsxs)(d.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"11px"},children:["Cost: $",e.costPrice.toFixed(2)," \u2022 Markup: ",e.markupPercentage.toFixed(0),"%"]})}),void 0!==e.current_stock&&(0,ne.jsxs)(l.A,{sx:{mt:1},children:[(0,ne.jsxs)(d.A,{variant:"caption",color:e.isLowStock?"error":"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.isLowStock&&(0,ne.jsx)("span",{style:{color:"#f44336",fontSize:"12px"},children:"\u26a0\ufe0f"}),"Stock: ",e.current_stock," ",e.unit,e.isLowStock&&" (Low)"]}),e.sku&&(0,ne.jsxs)(d.A,{variant:"caption",color:"text.secondary",sx:{fontSize:"10px"},children:["SKU: ",e.sku]})]}),(0,ne.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[(0,ne.jsx)(j.A,{size:"small",type:"number",value:$e[e.id]||1,onChange:t=>{const i=parseInt(t.target.value)||1,r=void 0!==e.current_stock?e.current_stock:999;Ze((t=>(0,a.A)((0,a.A)({},t),{},{[e.id]:Math.max(1,Math.min(i,r))})))},inputProps:{min:1,max:void 0!==e.current_stock?e.current_stock:999},sx:{width:60},onClick:e=>e.stopPropagation(),disabled:0===e.current_stock}),(0,ne.jsx)(_.A,{size:"small",variant:"contained",onClick:t=>{t.stopPropagation(),((e,t)=>{const i=t||$e[e.id]||1;if(void 0!==e.current_stock&&i>e.current_stock)return void alert("Only ".concat(e.current_stock," ").concat(e.unit," available in stock. Please adjust quantity."));const r={id:Date.now().toString(),description:e.name,quantity:i,unit_price:e.price,total:i*e.price,type:"material",inventory_item_id:void 0!==e.current_stock?parseInt(e.id):null,sku:e.sku||null};He((e=>[...e,r])),It([...Oe,r]),void 0!==e.current_stock&&Mt(parseInt(e.id),i,"estimate"),Ze((t=>(0,a.A)((0,a.A)({},t),{},{[e.id]:1})))})(e)},startIcon:(0,ne.jsx)(K.A,{}),fullWidth:!0,disabled:0===e.current_stock,color:e.isLowStock?"warning":"primary",children:0===e.current_stock?"Out of Stock":"Add"})]})]})})},e.id)))})]},e)}))]}),(0,ne.jsx)(D.A,{children:(0,ne.jsx)(_.A,{onClick:()=>Ue(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=757.aa78ab1e.chunk.js.map